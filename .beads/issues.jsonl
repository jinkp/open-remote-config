{"id":"plugin-2y6","title":"Add discovery limits to prevent DoS","description":"Security: Add configurable limits to agent discovery - max files scanned, max file size (256KB), max depth. Log when limits hit. Add tests for large files and too many files.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-04T14:19:50.716986+01:00","updated_at":"2026-01-04T14:26:47.41427+01:00","closed_at":"2026-01-04T14:26:47.41427+01:00","close_reason":"Added discovery limits: max 100 files, 256KB max file size, max 10 directory depth. Added tests."}
{"id":"plugin-328","title":"Implement skill symlink management","description":"Manage symlinks for imported skills:\n\nStorage layout:\n~/.config/opencode/skill/\n‚îú‚îÄ‚îÄ .plugins/\n‚îÇ   ‚îî‚îÄ‚îÄ \u003crepo-short-name\u003e/\n‚îÇ       ‚îî‚îÄ‚îÄ \u003cskill-name\u003e -\u003e ~/.cache/.../skill/\u003cskill-name\u003e/\n\nFeatures:\n- Create .plugins/ directory structure\n- Create symlinks from cloned repos to .plugins/\n- Filter skills based on config (all or specific list)\n- Remove stale symlinks when skills are unconfigured\n- Handle nested skill directories","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T12:44:05.245286+01:00","updated_at":"2025-12-28T13:00:16.985351+01:00","closed_at":"2025-12-28T13:00:16.985351+01:00","close_reason":"Symlink management implemented with create, cleanup, and conflict detection functions.","dependencies":[{"issue_id":"plugin-328","depends_on_id":"plugin-de0","type":"blocks","created_at":"2025-12-28T12:44:34.01529+01:00","created_by":"daemon"},{"issue_id":"plugin-328","depends_on_id":"plugin-o01","type":"blocks","created_at":"2025-12-28T12:44:42.703332+01:00","created_by":"daemon"}]}
{"id":"plugin-3g6","title":"Implement .gitignore management","description":"Automatically manage .gitignore to prevent committing imported skills:\n\n- Find the git root of the skill directory (walk up from ~/.config/opencode/skill/)\n- If skill directory is in a git repo, add '.plugins/' to .gitignore at git root\n- Create .gitignore if it doesn't exist\n- Append to existing .gitignore if .plugins/ not already present\n- If skill directory is not in a git repo, do nothing","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T12:44:09.253239+01:00","updated_at":"2025-12-28T13:01:17.096141+01:00","closed_at":"2025-12-28T13:01:17.096141+01:00","close_reason":"Gitignore management added to symlinks.ts with findGitRoot and ensureGitignore functions.","dependencies":[{"issue_id":"plugin-3g6","depends_on_id":"plugin-de0","type":"blocks","created_at":"2025-12-28T12:44:34.182661+01:00","created_by":"daemon"},{"issue_id":"plugin-3g6","depends_on_id":"plugin-328","type":"blocks","created_at":"2025-12-28T12:44:42.88316+01:00","created_by":"daemon"}]}
{"id":"plugin-3k2","title":"Harden gray-matter parsing to YAML-only safe mode","description":"Security: gray-matter can evaluate JS/TOML frontmatter. Force YAML-only parsing with safe schema to prevent code execution from untrusted remote repos. Add regression test for malicious frontmatter payloads.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-04T14:19:50.013163+01:00","updated_at":"2026-01-04T14:25:20.878213+01:00","closed_at":"2026-01-04T14:25:20.878213+01:00","close_reason":"Disabled JavaScript/CoffeeScript engines in gray-matter to prevent code execution. Added security tests."}
{"id":"plugin-4lu","title":"Implement user-facing logging","description":"Implement clear logging for user feedback:\n\nOn startup:\n[remote-skills] Syncing 2 repositories...\n[remote-skills] ‚úì company/shared-skills (main) - 5 skills\n[remote-skills] ‚úì team/team-skills (v1.2.0) - 3 skills\n[remote-skills] ‚ö† Conflict: 'git-commit' exists locally, skipping\n[remote-skills] 7 remote skills available\n\nOn error:\n[remote-skills] ‚úó Failed to sync company/shared-skills: \u003cerror message\u003e\n\nBackground mode updates:\n[remote-skills] Updates available. Restart OpenCode to load new skills.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T12:44:22.838881+01:00","updated_at":"2025-12-28T13:03:37.44007+01:00","closed_at":"2025-12-28T13:03:37.44007+01:00","close_reason":"User-facing logging already implemented in index.ts with all required message formats.","dependencies":[{"issue_id":"plugin-4lu","depends_on_id":"plugin-de0","type":"blocks","created_at":"2025-12-28T12:44:34.724263+01:00","created_by":"daemon"},{"issue_id":"plugin-4lu","depends_on_id":"plugin-dpt","type":"blocks","created_at":"2025-12-28T12:44:43.589042+01:00","created_by":"daemon"}]}
{"id":"plugin-63b","title":"Align AgentConfig schema with OpenCode types","description":"Remove/mitigate unsafe 'as unknown as' cast by aligning schema with OpenCode AgentConfig. Add bounds for temperature (0-2) and top_p (0-1). Consider transforming unknown keys to options field.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T14:19:52.561866+01:00","updated_at":"2026-01-04T14:28:57.953791+01:00","closed_at":"2026-01-04T14:28:57.953791+01:00","close_reason":"Added bounds for temperature (0-2) and top_p (0-1) to align with LLM provider expectations. Added tests."}
{"id":"plugin-6my","title":"Implement configuration schema","description":"Define and implement the configuration schema for remote-skills:\n\n```jsonc\n{\n  \"remote-skills\": {\n    \"repositories\": [\n      {\n        \"url\": \"git@github.com:company/shared-skills.git\",\n        \"ref\": \"main\",  // branch, tag, or commit SHA (optional)\n        \"skills\": [\"code-review\", \"kotlin-pro\"]  // optional, imports all if omitted\n      }\n    ],\n    \"sync\": \"blocking\" | \"background\"  // default: blocking\n  }\n}\n```\n\n- Use Zod for schema validation\n- Support reading from opencode.json config\n- Provide TypeScript types for the config","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T12:43:56.600661+01:00","updated_at":"2025-12-28T12:57:47.191068+01:00","closed_at":"2025-12-28T12:57:47.191068+01:00","close_reason":"Configuration schema implemented with Zod validation, type exports, and helper functions for repo naming.","dependencies":[{"issue_id":"plugin-6my","depends_on_id":"plugin-de0","type":"blocks","created_at":"2025-12-28T12:44:33.655992+01:00","created_by":"daemon"},{"issue_id":"plugin-6my","depends_on_id":"plugin-ejp","type":"blocks","created_at":"2025-12-28T12:44:42.350254+01:00","created_by":"daemon"}]}
{"id":"plugin-791","title":"Support both skill/ and skills/ directories","description":"Some repositories use 'skills/' (plural) instead of 'skill/' (singular). The plugin now checks for both.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T15:03:45.267532+01:00","updated_at":"2025-12-28T15:04:00.809514+01:00","closed_at":"2025-12-28T15:04:00.809514+01:00","close_reason":"Closed"}
{"id":"plugin-ac2","title":"Fix user config precedence check","description":"Replace truthy check with hasOwnProperty for user-agent precedence. Current code overwrites falsy user values like null. Add tests for edge cases.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T14:19:51.226589+01:00","updated_at":"2026-01-04T14:27:58.238799+01:00","closed_at":"2026-01-04T14:27:58.238799+01:00","close_reason":"Fixed user config precedence using hasOwnProperty to correctly handle falsy values like null. Added test."}
{"id":"plugin-afg","title":"Implement conflict detection","description":"Detect and handle skill name conflicts:\n\n- Check if a local skill (not in .plugins/) exists with the same name\n- If conflict detected:\n  - Log warning to user\n  - Skip creating symlink for the conflicting remote skill\n  - Local skills always take precedence\n- Track which skills were skipped due to conflicts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T12:44:12.60723+01:00","updated_at":"2025-12-28T13:01:22.868111+01:00","closed_at":"2025-12-28T13:01:22.868111+01:00","close_reason":"Conflict detection already implemented in symlinks.ts via hasLocalConflict function.","dependencies":[{"issue_id":"plugin-afg","depends_on_id":"plugin-de0","type":"blocks","created_at":"2025-12-28T12:44:34.365783+01:00","created_by":"daemon"},{"issue_id":"plugin-afg","depends_on_id":"plugin-328","type":"blocks","created_at":"2025-12-28T12:44:43.059237+01:00","created_by":"daemon"}]}
{"id":"plugin-aih","title":"Remote Instructions Support","description":"Allow remote repositories to define instruction files via manifest.json that get injected into OpenCode's instructions config, making them available as context alongside AGENTS.md.\n\n## Goal\nEnable the remote-skills plugin to discover and inject instruction files from remote repositories into OpenCode's config.instructions array.\n\n## Background\nCurrently the remote-skills plugin can sync skills, agents, commands, and plugins from remote repositories. This epic adds support for instruction files - markdown files that provide context to the agent (similar to AGENTS.md or BD_INSTRUCTIONS.md).\n\n## Design Decisions\n1. **Manifest file**: `manifest.json` in repository root defines which instruction files to include\n2. **Format**: JSON only (matching existing config patterns)\n3. **No globs**: Explicit file paths only for predictability\n4. **Filtering**: Support include/exclude in remote-config.json (like skills/agents)\n5. **Markdown only**: Only .md files are accepted as instructions\n6. **Missing files**: Silently skipped (non-blocking)\n7. **Duplicates**: Allowed (all instructions from all repos appended)\n\n## Manifest Format\n```json\n{\n  \"$schema\": \"...\",\n  \"instructions\": [\n    \"session-protocol.md\",\n    \"guidelines/coding-style.md\"\n  ]\n}\n```\n\n## Remote Config Filtering\n```json\n{\n  \"repositories\": [{\n    \"url\": \"...\",\n    \"instructions\": \"*\"\n  }, {\n    \"url\": \"...\",\n    \"instructions\": [\"specific-file.md\"]\n  }]\n}\n```\n\n## Files to Create/Modify\n- `src/manifest.ts` - NEW: manifest schema and parser\n- `src/instruction.ts` - NEW: instruction discovery\n- `src/git.ts` - Add instructions to SyncResult\n- `src/index.ts` - Collect and inject instructions in config hook\n- `remote-skills.schema.json` - Add instructions filter\n- `manifest.schema.json` - NEW: manifest JSON schema\n- `testconfig/manifest.json` - NEW: test manifest\n- `src/instruction.test.ts` - NEW: tests\n- `src/manifest.test.ts` - NEW: tests","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-10T12:10:17.472524+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:03:02.923785+01:00","closed_at":"2026-01-12T15:03:02.923785+01:00","close_reason":"Epic complete: All implementation files created, all tests pass (233 tests), remote-skills.schema.json updated with instructions filter"}
{"id":"plugin-aih.1","title":"Create manifest schema and parser","description":"Create `src/manifest.ts` with Zod schema and parser for `manifest.json`.\n\n## Implementation Details\n\n### Schema Definition\n```typescript\nimport { z } from 'zod'\n\nexport const ManifestSchema = z.object({\n  \\$schema: z.string().optional(),\n  instructions: z.array(z.string()).optional().default([]),\n})\n\nexport type Manifest = z.infer\u003ctypeof ManifestSchema\u003e\n```\n\n### Functions to Implement\n1. `loadManifest(repoPath: string): Manifest | null`\n   - Look for `manifest.json` in repo root only\n   - Parse JSON and validate with Zod schema\n   - Return null if file doesn't exist\n   - Log warning and return null if parse/validation fails\n\n### Validation Rules\n- instructions array must contain strings\n- Each instruction path must end with `.md` (markdown only)\n- Paths must be relative (no absolute paths starting with /)\n\n## Acceptance Criteria\n- [ ] ManifestSchema defined with Zod\n- [ ] loadManifest function implemented\n- [ ] Validates .md extension on instruction paths\n- [ ] Returns null gracefully for missing/invalid manifests\n- [ ] Logs warnings for validation errors","status":"closed","priority":2,"issue_type":"task","estimated_minutes":30,"created_at":"2026-01-10T12:10:33.907933+01:00","created_by":"jgordijn","updated_at":"2026-01-10T13:17:01.475303+01:00","closed_at":"2026-01-10T13:17:01.475303+01:00","close_reason":"Implemented and verified","dependencies":[{"issue_id":"plugin-aih.1","depends_on_id":"plugin-aih","type":"parent-child","created_at":"2026-01-10T12:10:33.909685+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.1.1","title":"CRITICAL: Reject path traversal in manifest instruction paths","description":"File: opencode-remote-skills/src/manifest.ts:13-19\nIssue: Schema only rejects absolute paths starting with \"/\" and enforces .md, but allows \"../\" segments. This enables path traversal when later resolving repoPath + instruction (e.g., \"../secrets.md\"), potentially reading files outside the repo.\nFix: Add validation to reject path.isAbsolute, \"..\" segments, and normalize+check that resolved path stays within repo root. Consider strict regex: disallow leading \"./\"? or allow, but disallow \"..\" and backslashes on Windows. Add test cases for \"../x.md\" and \"nested/../../x.md\".","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T13:11:01.648345+01:00","created_by":"jgordijn","updated_at":"2026-01-10T13:12:59.427978+01:00","closed_at":"2026-01-10T13:12:59.427978+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-aih.1.1","depends_on_id":"plugin-aih.1","type":"parent-child","created_at":"2026-01-10T13:11:01.65222+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.1.2","title":"SUGGESTION: Add test for path traversal rejection and ensure no tmp artifacts","description":"File: opencode-remote-skills/src/manifest.test.ts:40-59\nIssue: Tests cover absolute path and extension but not traversal paths like \"../x.md\". Also uses a fixed \".test-manifest-temp\" directory under cwd; parallel test runs could collide.\nFix: Add traversal cases and consider using mkdtempSync in OS tmpdir for isolation (or include unique suffix via randomUUID). Ensure cleanup remains robust.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-10T13:11:01.65807+01:00","created_by":"jgordijn","updated_at":"2026-01-10T13:13:00.113067+01:00","closed_at":"2026-01-10T13:13:00.113067+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-aih.1.2","depends_on_id":"plugin-aih.1","type":"parent-child","created_at":"2026-01-10T13:11:01.659137+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.1.3","title":"SUGGESTION: Avoid sync fs calls in manifest loader or document rationale","description":"File: opencode-remote-skills/src/manifest.ts:47-53\nIssue: loadManifest uses existsSync/readFileSync which may block event loop if called frequently across many repos.\nFix: If this runs in CLI startup and repo count is small, add brief rationale; otherwise consider async fs.promises with await. Not mandatory if performance impact is negligible in this plugin.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-10T13:11:01.6695+01:00","created_by":"jgordijn","updated_at":"2026-01-10T13:12:59.888157+01:00","closed_at":"2026-01-10T13:12:59.888157+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-aih.1.3","depends_on_id":"plugin-aih.1","type":"parent-child","created_at":"2026-01-10T13:11:01.670631+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.1.4","title":"HIGH: Improve manifest path validation for Windows and whitespace","description":"File: opencode-remote-skills/src/manifest.ts:13-19\nIssue: Validation only checks startsWith(\"/\") and endsWith(\".md\"). On Windows, absolute paths can be like \"C:\\\\...\" or start with \"\\\\\\\\server\\\\share\". Also leading/trailing whitespace could bypass expectations (\"README.md \").\nFix: Use path.isAbsolute() plus checks for UNC paths, trim() before validation, and consider rejecting backslashes \"\\\\\" to enforce POSIX-style repo-relative paths. Add tests: \"C:\\\\abs.md\", \"\\\\\\\\server\\\\share\\\\x.md\", \"README.md \".","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T13:11:01.681455+01:00","created_by":"jgordijn","updated_at":"2026-01-10T13:12:59.66437+01:00","closed_at":"2026-01-10T13:12:59.66437+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-aih.1.4","depends_on_id":"plugin-aih.1","type":"parent-child","created_at":"2026-01-10T13:11:01.682779+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.1.5","title":"HIGH: Manifest instruction path schema allows empty or dot segments","description":"File: opencode-remote-skills/src/manifest.ts:22-39\nIssue: instructionPathSchema trims and checks extension/absolute/backslashes/traversal but still allows empty strings and paths like \".md\", \"./README.md\", \"docs//file.md\", or leading \"/\"-like variants after trimming. Empty or ambiguous paths can cause confusing errors later (e.g., join(repoPath, \"\") points at repo root) and make filtering brittle.\nWhy it matters: Parser should fail-fast with a clear error instead of passing invalid/ambiguous paths that later resolve unexpectedly.\nHow to fix: Add additional refinements:\n- path.length \u003e 0\n- no segment is empty (reject consecutive slashes and trailing slash)\n- optionally disallow leading \"./\" to keep canonical form (or normalize it away)\nAdd tests for \"\", \".md\", \"./README.md\", \"docs//file.md\" and decide expected behavior.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T13:13:24.033948+01:00","created_by":"jgordijn","updated_at":"2026-01-10T13:14:49.394254+01:00","closed_at":"2026-01-10T13:14:49.394254+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-aih.1.5","depends_on_id":"plugin-aih.1","type":"parent-child","created_at":"2026-01-10T13:13:24.039887+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.1.6","title":"‚ö†Ô∏è HIGH PRIORITY: manifest path schema does not reject \".\" segment","description":"File: opencode-remote-skills/src/manifest.ts:25-64\nIssue: instructionPathSchema rejects \"..\" traversal segments but currently allows a standalone \".\" path segment in nested paths (e.g., \"docs/./setup.md\"). This is not a traversal vulnerability, but it is a normalization/consistency issue that can defeat include/exclude filtering and create duplicate references to the same file (\"docs/setup.md\" vs \"docs/./setup.md\").\nWhy it matters: Later stages (instruction discovery/filtering) likely treat paths as canonical strings. Allowing equivalent-but-different representations increases surprise and can bypass configured allowlists/denylists.\nHow to fix: Add a refinement to reject \".\" as any segment (similar to containsPathTraversal), OR normalize by removing \"/./\" occurrences safely. Add tests for \"docs/./setup.md\" and \"././README.md\" (the latter currently normalizes only the first \"./\").","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T13:15:08.98889+01:00","created_by":"jgordijn","updated_at":"2026-01-10T13:16:20.363517+01:00","closed_at":"2026-01-10T13:16:20.363517+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-aih.1.6","depends_on_id":"plugin-aih.1","type":"parent-child","created_at":"2026-01-10T13:15:08.991783+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.10","title":"Fix JSON schema to match ImportConfig shape","description":"The JSON schema (remote-skills.schema.json) uses simple string[] for filter properties (skills, agents, commands, plugins, instructions), but the Zod implementation (ImportConfigSchema in config.ts) supports {include: [...]} and {exclude: [...]} objects. The schema should be updated to match the implementation to provide proper editor validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T14:02:59.724931+01:00","created_by":"jgordijn","updated_at":"2026-01-12T14:12:31.955124+01:00","closed_at":"2026-01-12T14:12:31.955124+01:00","close_reason":"Implemented and verified","dependencies":[{"issue_id":"plugin-aih.10","depends_on_id":"plugin-aih","type":"parent-child","created_at":"2026-01-12T14:02:59.725888+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.10.1","title":"HIGH: JSON schema filterConfig allows include+exclude simultaneously","description":"File: remote-skills.schema.json:29-64\\nIssue: filterConfig uses oneOf with required [include] and [exclude] but does not forbid the other property. With additionalProperties=false, objects like {include:[...], exclude:[...]} satisfy both branches, making validation fail under oneOf (matches multiple). This is a confusing UX and can break editor validation.\\nFix: Add \"not\": { \"required\": [\"exclude\"] } on the include branch and vice versa (or use anyOf + mutual exclusion constraint).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T14:10:47.890481+01:00","created_by":"jgordijn","updated_at":"2026-01-12T14:11:57.75343+01:00","closed_at":"2026-01-12T14:11:57.75343+01:00","close_reason":"Not a bug: additionalProperties=false correctly prevents objects with both include and exclude. Tested with ajv-cli: {include:[...]} valid, {exclude:[...]} valid, {include:[...], exclude:[...]} invalid (as expected).","dependencies":[{"issue_id":"plugin-aih.10.1","depends_on_id":"plugin-aih.10","type":"parent-child","created_at":"2026-01-12T14:10:47.891481+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.2","title":"Create instruction discovery module","description":"Create `src/instruction.ts` with instruction discovery logic.\n\n## Implementation Details\n\n### Types\n```typescript\nexport interface InstructionInfo {\n  name: string   // relative path from manifest (e.g., 'session-protocol.md')\n  path: string   // absolute path to file\n}\n```\n\n### Functions to Implement\n1. `discoverInstructions(repoPath: string): InstructionInfo[]`\n   - Call loadManifest(repoPath)\n   - If no manifest, return empty array\n   - For each instruction in manifest:\n     - Resolve absolute path: path.join(repoPath, instructionName)\n     - Check if file exists (fs.existsSync)\n     - Skip silently if file doesn't exist\n     - Include if file exists\n   - Return array of InstructionInfo\n\n### Edge Cases\n- Empty manifest.instructions array ‚Üí return []\n- Missing manifest.json ‚Üí return []\n- Instruction file doesn't exist ‚Üí skip silently\n- Instruction not ending in .md ‚Üí should be rejected by manifest validation\n\n## Dependencies\n- Depends on: manifest.ts (Task 1)\n\n## Acceptance Criteria\n- [ ] InstructionInfo type exported\n- [ ] discoverInstructions function implemented\n- [ ] Silently skips missing files\n- [ ] Returns absolute paths to existing files\n- [ ] Returns empty array for missing manifest","status":"closed","priority":2,"issue_type":"task","estimated_minutes":20,"created_at":"2026-01-10T12:10:41.287119+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:24:05.415297+01:00","closed_at":"2026-01-12T13:24:05.415297+01:00","close_reason":"Implemented and verified","dependencies":[{"issue_id":"plugin-aih.2","depends_on_id":"plugin-aih","type":"parent-child","created_at":"2026-01-10T12:10:41.288553+01:00","created_by":"jgordijn"},{"issue_id":"plugin-aih.2","depends_on_id":"plugin-aih.1","type":"blocks","created_at":"2026-01-10T12:12:23.91546+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.2.1","title":"üö® CRITICAL: Do not silently ignore invalid manifest JSON in instruction discovery","description":"File: src/instruction.ts:26-30\nIssue: discoverInstructions relies on loadManifest() returning undefined for missing/invalid manifests and then returns []. That causes silent misconfiguration: a broken manifest results in ‚Äúno instructions‚Äù rather than a clear error, which can mask repo configuration problems and make troubleshooting difficult.\nFix recommendation: Distinguish between ‚Äúmanifest missing‚Äù vs ‚Äúmanifest invalid‚Äù (e.g., loadManifest throws a typed error or returns { ok:false, error }). For invalid JSON/schema, either throw (and let sync surface error) or log a warning including repoPath.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T13:15:16.382768+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:17:42.834173+01:00","closed_at":"2026-01-12T13:17:42.834173+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-aih.2.1","depends_on_id":"plugin-aih.2","type":"parent-child","created_at":"2026-01-12T13:15:16.384174+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.2.2","title":"‚ö†Ô∏è HIGH: Potential path traversal via manifest instruction paths not enforced here","description":"File: src/instruction.ts:34-41\nIssue: discoverInstructions uses path.join(repoPath, instructionName) and checks existsSync. If an attacker can supply manifest.json, instructionName like \"../outside.md\" could point outside repoPath. Relying solely on upstream manifest validation is brittle and creates a security boundary confusion.\nFix recommendation: Add a defense-in-depth check: resolve(repoPath, instructionName) and ensure it startsWith(realpath(repoPath)+path.sep) (or similar). Alternatively, import and reuse the manifest instruction path schema or a shared normalize/validate helper that rejects traversal, absolute paths, and backslashes.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T13:15:20.834558+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:19:24.208941+01:00","closed_at":"2026-01-12T13:19:24.208941+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-aih.2.2","depends_on_id":"plugin-aih.2","type":"parent-child","created_at":"2026-01-12T13:15:20.835671+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.2.3","title":"‚ö†Ô∏è HIGH: instruction tests assert behavior for invalid manifest JSON but implementation does not guarantee it","description":"File: src/instruction.test.ts:34-40, 134-140\nIssue: Test expects discoverInstructions to return [] for missing instructions field and invalid JSON. That implicitly constrains loadManifest() behavior (must swallow parse errors and missing-field schema issues). If loadManifest changes to throw (arguably better), this test will block it.\nFix recommendation: Decide desired contract: either discoverInstructions should surface invalid manifests (preferable) or it should explicitly handle/normalize and then tests can assert that behavior. Update tests to match the decided behavior (e.g., expect toThrow for invalid JSON, or stub/mocks if separating manifest parsing from discovery).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T13:15:25.373233+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:20:11.35605+01:00","closed_at":"2026-01-12T13:20:11.35605+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-aih.2.3","depends_on_id":"plugin-aih.2","type":"parent-child","created_at":"2026-01-12T13:15:25.374349+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.2.4","title":"üí° SUGGESTION: Avoid redundant absolute-path assertion in tests","description":"File: src/instruction.test.ts:118-132\nIssue: The test checks result[0].path.startsWith(\"/\") to assert absolute paths. This is platform-specific and redundant because readmePath is already constructed from mkdtempSync(), which returns an absolute path, and other tests already compare with readmePath.\nFix recommendation: Replace with expect(result[0].path).toBe(readmePath) (already done in earlier test) or use path.isAbsolute(result[0].path) for cross-platform clarity.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T13:15:31.730551+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:20:52.116301+01:00","closed_at":"2026-01-12T13:20:52.116301+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-aih.2.4","depends_on_id":"plugin-aih.2","type":"parent-child","created_at":"2026-01-12T13:15:31.73172+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.2.5","title":"‚ö†Ô∏è HIGH: Defense-in-depth repo boundary check rejects repo root files","description":"File: src/instruction.ts:57-58\nIssue: resolvedPath is compared against resolvedRepoPath + sep. For instructionName like \"README.md\", resolvedPath === resolvedRepoPath + \"/README.md\" so OK, but if instructionName is \"\" (should be impossible via schema) it would resolve to repo root and be rejected; more importantly, if repoPath has a trailing separator or is a filesystem root, the startsWith check can behave unexpectedly. Also symlinks/realpath are not accounted for, which can cause false negatives/positives depending on how repoPath is provided.\nWhy it matters: Can silently drop legitimate instructions or create inconsistent behavior across platforms/inputs.\nHow to fix: Use resolve(repoPath, instructionName) and define the allowed prefix as resolvedRepoPath (no trailing sep) and allow equality when resolvedPath===resolvedRepoPath only if instructionName is empty (or reject earlier). Consider fs.realpathSync for both paths if you want to defend against symlink escape; otherwise document that boundary check is purely lexical.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T13:22:34.664818+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:23:36.73178+01:00","closed_at":"2026-01-12T13:23:36.73178+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-aih.2.5","depends_on_id":"plugin-aih.2","type":"parent-child","created_at":"2026-01-12T13:22:34.665905+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.3","title":"Add instructions to SyncResult and discovery","description":"Update `src/git.ts` to include instructions in sync results.\n\n## Implementation Details\n\n### Update SyncResult Interface\n```typescript\nexport interface SyncResult {\n  repoId: string\n  repoPath: string\n  shortName: string\n  ref: string\n  skills: SkillInfo[]\n  agents: AgentInfo[]\n  commands: CommandInfo[]\n  plugins: PluginInfo[]\n  instructions: InstructionInfo[]  // NEW\n  updated: boolean\n  error?: string\n}\n```\n\n### Update syncLocalDirectory()\n- Call discoverInstructions(localPath)\n- Filter instructions based on config.instructions setting (like skills/agents)\n- Add to result\n\n### Update syncGitRepository()\n- Call discoverInstructions(repoPath) after clone/checkout\n- Filter instructions based on config.instructions setting\n- Add to result\n\n### Filtering Logic (same pattern as skills/agents)\n```typescript\n// Discover instructions\ninstructions = await discoverInstructions(repoPath)\n\n// Filter if specific ones requested\nif (config.instructions \u0026\u0026 config.instructions !== '*' \u0026\u0026 Array.isArray(config.instructions)) {\n  const requested = new Set(config.instructions)\n  instructions = instructions.filter(i =\u003e requested.has(i.name))\n}\n```\n\n## Dependencies\n- Depends on: instruction.ts (Task 2)\n\n## Acceptance Criteria\n- [ ] SyncResult includes instructions field\n- [ ] syncLocalDirectory discovers instructions\n- [ ] syncGitRepository discovers instructions\n- [ ] Filtering works with '*' and array of names\n- [ ] Re-export InstructionInfo type from git.ts","status":"closed","priority":2,"issue_type":"task","estimated_minutes":30,"created_at":"2026-01-10T12:10:49.73602+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:45:12.426071+01:00","closed_at":"2026-01-12T13:45:12.426071+01:00","close_reason":"Implemented and verified","dependencies":[{"issue_id":"plugin-aih.3","depends_on_id":"plugin-aih","type":"parent-child","created_at":"2026-01-10T12:10:49.737576+01:00","created_by":"jgordijn"},{"issue_id":"plugin-aih.3","depends_on_id":"plugin-aih.2","type":"blocks","created_at":"2026-01-10T12:12:24.465578+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.3.1","title":"‚ö†Ô∏è HIGH: RepositoryConfigSchema instructions docs mention include-exclude but task expects '*' or array","description":"File: src/config.ts:75-80\\nIssue: docs and schema define instructions=ImportConfig (\"*\" or {include/exclude}), but parent task for bead plugin-aih.3 specifies filtering config.instructions should be '*' or array of names. This mismatch can confuse users and break compatibility with previously documented config shapes.\\nFix recommendation: Either align implementation and schema/docs to accept arrays (and update shouldImport), or update task/bead acceptance criteria to match include/exclude pattern used for skills/agents/commands/plugins. Ensure any README/schema consumers are updated accordingly.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T13:41:55.13052+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:43:02.126+01:00","closed_at":"2026-01-12T13:43:02.126+01:00","close_reason":"Implementation correctly uses ImportConfigSchema pattern (include/exclude) matching skills/agents/commands/plugins - task description was simplified but implementation follows codebase convention","dependencies":[{"issue_id":"plugin-aih.3.1","depends_on_id":"plugin-aih.3","type":"parent-child","created_at":"2026-01-12T13:41:55.132111+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.3.2","title":"üö® CRITICAL: SyncResult interface change requires updating all SyncResult producers","description":"File: src/git.ts:49-61 and src/config-hook.test.ts:82-100\\nIssue: SyncResult now requires instructions: InstructionInfo[]. Any code constructing SyncResult must be updated or it will break compilation/runtime typing expectations. Only config-hook.test.ts mock updated; need to verify all other producers/tests compile, and any external consumers of SyncResult handle new field.\\nFix recommendation: Search for all SyncResult constructions and add instructions: [] or discovered value. Consider making field optional for backward compatibility or bump major version if this is a public API.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T13:41:55.16835+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:42:55.362202+01:00","closed_at":"2026-01-12T13:42:55.362202+01:00","close_reason":"SyncResult producers were already updated in the implementation - all tests pass","dependencies":[{"issue_id":"plugin-aih.3.2","depends_on_id":"plugin-aih.3","type":"parent-child","created_at":"2026-01-12T13:41:55.169408+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.3.3","title":"‚ö†Ô∏è HIGH: Path boundary check in discoverInstructions may falsely reject or allow due to lexical startsWith","description":"File: src/instruction.ts:52-64\\nIssue: resolvedPath.startsWith(resolvedRepoPath + sep) is a lexical check and can be tricky with roots/trailing separators; also absolutePath uses join(repoPath,instructionName) but instructionName could be empty or '.' etc if schema bypassed. This can lead to inconsistent behavior across platforms and potential bypass if not normalized consistently.\\nFix recommendation: Use resolve(repoPath, instructionName) directly; compare with resolvedRepoPath and allow equality only if explicitly intended. Consider fs.realpathSync for both if you want to defend against symlink escape, or document limitations clearly.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T13:41:55.325116+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:45:44.206312+01:00","closed_at":"2026-01-12T13:45:44.206312+01:00","close_reason":"Parent task closed - path boundary already has defense-in-depth checks from plugin-aih.2.2"}
{"id":"plugin-aih.3.4","title":"‚ö†Ô∏è HIGH: Instruction discovery in syncLocalDirectory/syncGitRepository is synchronous but may become async","description":"File: src/git.ts:726-730 and src/git.ts:810-814\\nIssue: discoverInstructions is currently sync; called without await. If instruction discovery later needs async IO (e.g., remote manifests, streaming), signature change will require touching sync code. More importantly, other discovery ops are async; mixing sync disk IO can block event loop on large repos.\\nFix recommendation: Consider making discoverInstructions async (return Promise\u003cInstructionInfo[]\u003e) and await it consistently, or document why sync is acceptable and ensure manifest reading is bounded/fast.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T13:41:55.335729+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:45:45.442104+01:00","closed_at":"2026-01-12T13:45:45.442104+01:00","close_reason":"Parent task closed - sync vs async is a design decision that doesn't block this feature"}
{"id":"plugin-aih.3.5","title":"üí° SUGGESTION: Add DoS bounds for instructions discovery","description":"File: src/instruction.ts:25-75\\nIssue: discoverInstructions processes every manifest.instructions entry without limiting count or file stats size checks, unlike agents/commands/plugins which enforce DISCOVERY_LIMITS. A malicious manifest could list thousands of files leading to lots of existsSync calls.\\nFix recommendation: Add a reasonable max instruction count (and maybe max path length) and log a warning when exceeded, similar to DISCOVERY_LIMITS.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T13:41:55.33585+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:44:44.582902+01:00","closed_at":"2026-01-12T13:44:44.582902+01:00","close_reason":"Fixed - Added INSTRUCTION_LIMITS with max 100 entries and 500 char path length","dependencies":[{"issue_id":"plugin-aih.3.5","depends_on_id":"plugin-aih.3","type":"parent-child","created_at":"2026-01-12T13:41:55.338963+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.3.6","title":"üí° SUGGESTION: Reduce duplication and runtime by using shared tmpdir setup in git tests","description":"File: src/git.test.ts:1389-1580\\nIssue: Many new tests copy/paste tmpDir creation, manifest/file writes, and cleanup. This increases maintenance and prolongs test runtime.\\nFix recommendation: Extract helpers (createRepoWithManifest, withTempDir) or use beforeEach/afterEach within the describe block.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T13:41:55.365521+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:44:45.745356+01:00","closed_at":"2026-01-12T13:44:45.745356+01:00","close_reason":"Fixed - Refactored tests to use beforeEach/afterEach for shared tmpDir setup","dependencies":[{"issue_id":"plugin-aih.3.6","depends_on_id":"plugin-aih.3","type":"parent-child","created_at":"2026-01-12T13:41:55.36688+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.3.7","title":"‚ö†Ô∏è HIGH: shouldImport uses includes on arrays; consider Set for performance with many items","description":"File: src/config.ts:90-104\\nIssue: shouldImport() uses Array.includes for include/exclude which is O(n) per item. For large repo inventories and filter lists, this becomes O(n*m).\\nFix recommendation: Precompute a Set once per config and reuse (or inside shouldImport detect and memoize). This is not urgent but can matter with many skills/plugins.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T13:41:55.371906+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:43:13.433934+01:00","closed_at":"2026-01-12T13:43:13.433934+01:00","close_reason":"Won't fix - premature optimization. Instruction lists are expected to be small (10-20 items). Array.includes is O(n) per call but n is tiny. Complexity of Set-based solution not justified.","dependencies":[{"issue_id":"plugin-aih.3.7","depends_on_id":"plugin-aih.3","type":"parent-child","created_at":"2026-01-12T13:41:55.3735+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.4","title":"Collect and inject instructions in plugin","description":"Update `src/index.ts` to collect instructions from sync results and inject them into config.\n\n## Implementation Details\n\n### Update performSync() Return Type\nAdd remoteInstructions to the return:\n```typescript\nasync function performSync(config: RemoteSkillsConfig): Promise\u003c{\n  results: SyncResult[]\n  skippedConflicts: string[]\n  totalSkills: number\n  remoteAgents: Map\u003cstring, RemoteAgent\u003e\n  remoteCommands: Map\u003cstring, RemoteCommand\u003e\n  remoteInstructions: string[]  // NEW - absolute paths\n  pluginsChanged: boolean\n  totalPlugins: number\n}\u003e\n```\n\n### Collect Instructions in performSync()\n```typescript\n// Collect instructions from all repositories (no first-wins, append all)\nconst remoteInstructions: string[] = []\nfor (const result of results) {\n  if (result.error) continue\n  for (const instruction of result.instructions) {\n    remoteInstructions.push(instruction.path)\n  }\n}\n\nif (remoteInstructions.length \u003e 0) {\n  log(`Discovered ${remoteInstructions.length} remote instructions`)\n}\n```\n\n### Update Config Hook\n```typescript\nconfig: async (config) =\u003e {\n  // ... existing agent/command injection ...\n  \n  // Inject instructions\n  if (remoteInstructions.length \u003e 0) {\n    // Ensure config.instructions is an array\n    if (!Array.isArray(config.instructions)) {\n      config.instructions = config.instructions ? [config.instructions] : []\n    }\n    \n    // Append all remote instructions\n    config.instructions.push(...remoteInstructions)\n    log(`Appended ${remoteInstructions.length} remote instructions`)\n  }\n}\n```\n\n### Update Summary Log\nInclude instructions count in the summary message:\n```typescript\nif (remoteInstructions.length \u003e 0) parts.push(`${remoteInstructions.length} instructions`)\n```\n\n## Dependencies\n- Depends on: git.ts updates (Task 3)\n\n## Acceptance Criteria\n- [ ] performSync collects instruction paths from all repos\n- [ ] Config hook appends instructions to config.instructions\n- [ ] Handles missing/undefined config.instructions gracefully\n- [ ] Logs instruction counts\n- [ ] Summary message includes instruction count","status":"closed","priority":2,"issue_type":"task","estimated_minutes":30,"created_at":"2026-01-10T12:11:10.452728+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:58:08.843441+01:00","closed_at":"2026-01-12T13:58:08.843441+01:00","close_reason":"Implemented and verified","dependencies":[{"issue_id":"plugin-aih.4","depends_on_id":"plugin-aih","type":"parent-child","created_at":"2026-01-10T12:11:10.455057+01:00","created_by":"jgordijn"},{"issue_id":"plugin-aih.4","depends_on_id":"plugin-aih.3","type":"blocks","created_at":"2026-01-10T12:12:25.238613+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.4.1","title":"HIGH: config hook mutates instructions without type guard","description":"File: src/index.ts:83-93\\nIssue: Instruction injection assumes config.instructions is string|string[] and blindly converts non-array values (including objects) into a one-element array, potentially corrupting user config or masking wrong types. Agents/commands injection explicitly type-checks object shape before mutating.\\nFix recommendation: Add a guard similar to agent/command blocks: if config.instructions is defined and not a string/array of strings, logError and skip. Optionally validate array contents are strings before push.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T13:50:15.456324+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:52:24.801446+01:00","closed_at":"2026-01-12T13:52:24.801446+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-aih.4.1","depends_on_id":"plugin-aih.4","type":"parent-child","created_at":"2026-01-12T13:50:15.457417+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.4.2","title":"SUGGESTION: avoid duplicating production logic in tests","description":"File: src/config-hook.test.ts:308-370\\nIssue: Tests re-implement collectInstructions/injectInstructions mirroring production logic. This can lead to false confidence if both are wrong in the same way (tests validate the reimplementation).\\nFix recommendation: Prefer testing the exported plugin/config hook behavior through RemoteSkillsPlugin (or extracting shared pure functions from src/index.ts and importing them in tests). If keeping helpers, add at least one integration test that exercises the actual plugin config hook path.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T13:50:21.478733+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:53:43.495921+01:00","closed_at":"2026-01-12T13:53:43.495921+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-aih.4.2","depends_on_id":"plugin-aih.4","type":"parent-child","created_at":"2026-01-12T13:50:21.479847+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.4.3","title":"HIGH: Instruction injection allows non-string entries in array","description":"File: src/index.ts:83-99\\nIssue: Instruction injection validates config.instructions is string or array, but does not validate array contents are strings. If user has instructions: [42] or [null] (still an array), injection proceeds and pushes strings, leaving mixed-type array. This can break downstream consumers expecting string[].\\nFix: Validate Array.isArray(config.instructions) implies every element is typeof string before mutation; otherwise logError and skip or coerce by filtering non-strings.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T13:54:11.798821+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:55:34.116959+01:00","closed_at":"2026-01-12T13:55:34.116959+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-aih.4.3","depends_on_id":"plugin-aih.4","type":"parent-child","created_at":"2026-01-12T13:54:11.800118+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.4.4","title":"SUGGESTION: Move remoteInstructions collection earlier","description":"File: src/index.ts:86-254\\nIssue: performSync collects remoteInstructions after plugin symlink work. That means we do plugin-symlink IO before we know if we even need instructions injection; also the function interleaves concerns (skills symlinks, agent/command collection, plugin symlinks, instruction collection).\\nFix: Consider collecting remoteInstructions alongside agents/commands earlier (same results loop) to keep logic grouped and slightly reduce work during failures. Not blocking.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T13:54:11.848372+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:56:21.398182+01:00","closed_at":"2026-01-12T13:56:21.398182+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-aih.4.4","depends_on_id":"plugin-aih.4","type":"parent-child","created_at":"2026-01-12T13:54:11.849352+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.4.5","title":"HIGH: Test helper has trailing spaces in doc comment violating lint/style","description":"File: src/config-hook.test.ts:339-345\nIssue: Doc comment contains blank lines with trailing whitespace (\"* \"), which can trigger lint/prettier failures and introduces noise in diffs.\nFix recommendation: Remove trailing spaces in the comment block (make blank lines just \"*\").","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T13:56:43.692535+01:00","created_by":"jgordijn","updated_at":"2026-01-12T13:57:14.306886+01:00","closed_at":"2026-01-12T13:57:14.306886+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-aih.4.5","depends_on_id":"plugin-aih.4","type":"parent-child","created_at":"2026-01-12T13:56:43.693637+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.5","title":"Update remote-skills schema for instructions","description":"Update `remote-skills.schema.json` to support instructions filtering in repository config.\n\n## Implementation Details\n\n### Add to Repository Definition\nAdd instructions property alongside skills, agents, commands, plugins:\n```json\n{\n  \"definitions\": {\n    \"repository\": {\n      \"properties\": {\n        \"instructions\": {\n          \"description\": \"Instructions to import from manifest.json. Use '*' for all instructions, or an array of instruction names (relative paths as defined in manifest.json)\",\n          \"oneOf\": [\n            {\n              \"type\": \"string\",\n              \"const\": \"*\",\n              \"description\": \"Import all instructions from the repository's manifest.json\"\n            },\n            {\n              \"type\": \"array\",\n              \"description\": \"List of specific instruction names to import\",\n              \"items\": {\n                \"type\": \"string\"\n              }\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n```\n\n### Update Schema Description\nUpdate the top-level description to mention instructions support.\n\n## Acceptance Criteria\n- [ ] instructions property added to repository definition\n- [ ] Supports '*' for all instructions\n- [ ] Supports array of specific instruction names\n- [ ] Schema validates correctly","status":"closed","priority":2,"issue_type":"task","estimated_minutes":15,"created_at":"2026-01-10T12:11:16.595637+01:00","created_by":"jgordijn","updated_at":"2026-01-12T14:03:25.497272+01:00","closed_at":"2026-01-12T14:03:25.497272+01:00","close_reason":"Implemented and verified","dependencies":[{"issue_id":"plugin-aih.5","depends_on_id":"plugin-aih","type":"parent-child","created_at":"2026-01-10T12:11:16.597122+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.5.1","title":"‚ö†Ô∏è HIGH: Remove unintended devcontainer script files from working tree","description":"Files: .devcontainer/* (untracked), start-devcontainer.sh (untracked)\\nIssue: Untracked devcontainer-related files are present alongside schema change. They are likely accidental and risk being committed as unrelated work. This violates smallest-change principle and can introduce security/reliability concerns if scripts configure mounts or secrets.\\nFix recommendation: Remove/ignore these files if not part of this bead; or explicitly scope and review them under a separate bead with documented purpose and security review.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T14:01:54.769459+01:00","created_by":"jgordijn","updated_at":"2026-01-12T14:02:24.221794+01:00","closed_at":"2026-01-12T14:02:24.221794+01:00","close_reason":"Not an issue - files are untracked and won't be staged. Only remote-skills.schema.json and .beads/ will be committed.","dependencies":[{"issue_id":"plugin-aih.5.1","depends_on_id":"plugin-aih.5","type":"parent-child","created_at":"2026-01-12T14:01:54.770593+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.5.2","title":"‚ö†Ô∏è HIGH: Schema instructions filter shape may not match implementation","description":"File: remote-skills.schema.json:112-127\\nIssue: Schema defines repository.instructions as either '*' or string[] of instruction names. Earlier beads indicate implementation uses ImportConfig shape (e.g., '*' or {include/exclude}). If implementation expects ImportConfig, this schema will mislead users and reject valid configs, or worse: accept configs the runtime ignores.\\nFix recommendation: Confirm src/config.ts uses the same shape for instructions. Align schema with actual accepted config (ImportConfigSchema) or update code to accept string[]. Add example in schema description consistent with behavior.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T14:01:54.828828+01:00","created_by":"jgordijn","updated_at":"2026-01-12T14:02:52.782362+01:00","closed_at":"2026-01-12T14:02:52.782362+01:00","close_reason":"Pre-existing schema/implementation inconsistency. The bead task specifies following the same pattern as skills/agents/commands/plugins, which I did. The mismatch between JSON schema (string[]) and Zod (include/exclude objects) exists for ALL properties, not just instructions. This is a separate issue to address.","dependencies":[{"issue_id":"plugin-aih.5.2","depends_on_id":"plugin-aih.5","type":"parent-child","created_at":"2026-01-12T14:01:54.830114+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.6","title":"Create manifest.schema.json","description":"Create JSON Schema file for `manifest.json` to provide editor support.\n\n## Implementation Details\n\n### File: manifest.schema.json\n```json\n{\n  \"\\$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"\\$id\": \"https://github.com/skill-marketplace/manifest.json\",\n  \"title\": \"OpenCode Remote Skills Manifest\",\n  \"description\": \"Manifest file for defining instructions and other resources to be imported by the remote-skills plugin\",\n  \"type\": \"object\",\n  \"additionalProperties\": false,\n  \"properties\": {\n    \"\\$schema\": {\n      \"type\": \"string\",\n      \"description\": \"JSON Schema reference for editor support\"\n    },\n    \"instructions\": {\n      \"type\": \"array\",\n      \"description\": \"List of markdown instruction files to include. Paths are relative to the manifest.json location.\",\n      \"items\": {\n        \"type\": \"string\",\n        \"pattern\": \"^[^/].*\\\\.md\\$\",\n        \"description\": \"Relative path to a markdown file (must end with .md)\"\n      },\n      \"default\": []\n    }\n  }\n}\n```\n\n### Notes\n- Pattern ensures paths are relative (don't start with /) and end with .md\n- additionalProperties: false for strict validation\n- Default empty array for instructions\n\n## Acceptance Criteria\n- [ ] Schema file created at opencode-remote-skills/manifest.schema.json\n- [ ] Validates instruction paths end with .md\n- [ ] Prevents absolute paths\n- [ ] Provides helpful descriptions for editor autocomplete","status":"closed","priority":2,"issue_type":"task","estimated_minutes":15,"created_at":"2026-01-10T12:11:25.628484+01:00","created_by":"jgordijn","updated_at":"2026-01-12T14:30:04.45587+01:00","closed_at":"2026-01-12T14:30:04.45587+01:00","close_reason":"Implemented and verified","dependencies":[{"issue_id":"plugin-aih.6","depends_on_id":"plugin-aih","type":"parent-child","created_at":"2026-01-10T12:11:25.62974+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.6.1","title":"‚ö†Ô∏è HIGH: JSON Schema should declare required array or allow omission","description":"File: manifest.schema.json:1-24\\nIssue: Schema defines properties but does not specify \"required\": [\"instructions\"]. Many schema validators/tools won\\u2019t apply \"default\"; omission means object is valid but editor won\\u2019t suggest/assume instructions. If runtime expects instructions to exist, this could be misleading.\\nFix recommendation: Decide contract: either (a) add \"required\": [\"instructions\"] and keep default removed, or (b) keep optional and explicitly document that omission is allowed; potentially add \"minItems\": 0 and examples.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T14:27:38.046767+01:00","created_by":"jgordijn","updated_at":"2026-01-12T14:28:55.849837+01:00","closed_at":"2026-01-12T14:28:55.849837+01:00","close_reason":"Fixed: Updated description to clarify instructions field is optional and can be omitted or empty","dependencies":[{"issue_id":"plugin-aih.6.1","depends_on_id":"plugin-aih.6","type":"parent-child","created_at":"2026-01-12T14:27:38.047886+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.6.2","title":"üí° SUGGESTION: Tighten instruction path pattern to prevent traversal","description":"File: manifest.schema.json:18\\nIssue: Pattern '^[^/].*\\.md$' prevents absolute paths but still allows '../x.md' and './x.md'. Depending on how loader resolves paths, '../' can escape repo root / intended directory, potentially reading unintended files.\\nFix recommendation: Use a stricter regex that disallows path traversal segments (e.g., no '..' or leading '.' segments), or document and enforce in runtime validation. Example pattern: '^(?!\\.?\\./)(?!.*(^|/)\\.\\.(/|$)).*\\.md$' (test with examples).","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T14:27:43.619181+01:00","created_by":"jgordijn","updated_at":"2026-01-12T14:28:57.509471+01:00","closed_at":"2026-01-12T14:28:57.509471+01:00","close_reason":"Fixed: Updated pattern to prevent path traversal (rejects ./, ../, and /../ segments)","dependencies":[{"issue_id":"plugin-aih.6.2","depends_on_id":"plugin-aih.6","type":"parent-child","created_at":"2026-01-12T14:27:43.620114+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.7","title":"Create test manifest in testconfig","description":"Create a test manifest.json and instruction files in `testconfig/` for testing.\n\n## Implementation Details\n\n### File: testconfig/manifest.json\n```json\n{\n  \"\\$schema\": \"../opencode-remote-skills/manifest.schema.json\",\n  \"instructions\": [\n    \"test-instruction.md\",\n    \"guidelines/coding-rules.md\"\n  ]\n}\n```\n\n### File: testconfig/test-instruction.md\n```markdown\n# Test Instruction\n\nThis is a test instruction file for the remote-skills plugin.\n\n## Rules\n- Rule 1: Be consistent\n- Rule 2: Write tests\n```\n\n### File: testconfig/guidelines/coding-rules.md\n```markdown\n# Coding Rules\n\nStandard coding guidelines for testing.\n```\n\n### Directory Structure\n```\ntestconfig/\n‚îú‚îÄ‚îÄ manifest.json\n‚îú‚îÄ‚îÄ test-instruction.md\n‚îú‚îÄ‚îÄ guidelines/\n‚îÇ   ‚îî‚îÄ‚îÄ coding-rules.md\n‚îú‚îÄ‚îÄ agent/\n‚îÇ   ‚îî‚îÄ‚îÄ mumbling-agent.md (existing)\n‚îú‚îÄ‚îÄ command/\n‚îÇ   ‚îî‚îÄ‚îÄ burp.md (existing)\n‚îî‚îÄ‚îÄ skill/\n    ‚îî‚îÄ‚îÄ log/ (existing)\n```\n\n## Acceptance Criteria\n- [ ] manifest.json created with valid schema reference\n- [ ] test-instruction.md created\n- [ ] guidelines/coding-rules.md created\n- [ ] Files can be discovered by the instruction discovery module","status":"closed","priority":2,"issue_type":"task","estimated_minutes":10,"created_at":"2026-01-10T12:11:41.24691+01:00","created_by":"jgordijn","updated_at":"2026-01-12T14:37:23.2279+01:00","closed_at":"2026-01-12T14:37:23.2279+01:00","close_reason":"Implemented and verified","dependencies":[{"issue_id":"plugin-aih.7","depends_on_id":"plugin-aih","type":"parent-child","created_at":"2026-01-10T12:11:41.249041+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.7.1","title":"üö® CRITICAL: testconfig/manifest.json schema path does not match bead acceptance criteria","description":"File: testconfig/manifest.json:2\nIssue: $schema points to ../manifest.schema.json, but bead plugin-aih.7 specifies ../opencode-remote-skills/manifest.schema.json. This breaks editor schema validation and may break tests expecting the documented path.\nFix: Update testconfig/manifest.json $schema to \"../opencode-remote-skills/manifest.schema.json\" (or update bead spec if schema was moved); ensure file exists and reference is correct.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T14:35:18.84506+01:00","created_by":"jgordijn","updated_at":"2026-01-12T14:35:53.697196+01:00","closed_at":"2026-01-12T14:35:53.697196+01:00","close_reason":"Bead spec was incorrect - the schema is at manifest.schema.json in root, so ../manifest.schema.json is correct from testconfig/","dependencies":[{"issue_id":"plugin-aih.7.1","depends_on_id":"plugin-aih.7","type":"parent-child","created_at":"2026-01-12T14:35:18.846122+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.7.2","title":"‚ö†Ô∏è HIGH: test fixture markdown content may be too generic to validate discovery edge cases","description":"File: testconfig/test-instruction.md:1-7, testconfig/guidelines/coding-rules.md:1-3\nIssue: Fixtures contain only generic text. If instruction discovery logic expects certain headings/unique markers, or tests later assert de-duplication/order/path handling, these fixtures may not provide strong signal.\nFix: Add minimal distinctive content per file (e.g., unique IDs, nested heading) so tests can assert correct file was loaded and ordering is preserved.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T14:35:22.415666+01:00","created_by":"jgordijn","updated_at":"2026-01-12T14:36:12.788208+01:00","closed_at":"2026-01-12T14:36:12.788208+01:00","close_reason":"Added unique Instruction-ID comments to each markdown file","dependencies":[{"issue_id":"plugin-aih.7.2","depends_on_id":"plugin-aih.7","type":"parent-child","created_at":"2026-01-12T14:35:22.4168+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.7.3","title":"üí° SUGGESTION: remove trailing whitespace newline from testconfig/manifest.json for consistency","description":"File: testconfig/manifest.json:8\nIssue: File currently ends with a blank line. Not harmful, but can create noisy diffs.\nFix: Remove trailing blank line and ensure file ends with single newline.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T14:35:25.002403+01:00","created_by":"jgordijn","updated_at":"2026-01-12T14:36:13.676596+01:00","closed_at":"2026-01-12T14:36:13.676596+01:00","close_reason":"Removed trailing newline from manifest.json","dependencies":[{"issue_id":"plugin-aih.7.3","depends_on_id":"plugin-aih.7","type":"parent-child","created_at":"2026-01-12T14:35:25.003484+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.7.4","title":"‚ö†Ô∏è HIGH: testconfig/manifest.json includes trailing blank line","description":"Issue: testconfig/manifest.json ends with an extra blank line. Previous cycle explicitly removed trailing newline; change appears regressed.\n\nWhy it matters: Causes noisy diffs and may violate repo formatting expectations or tests that do strict string comparisons for fixtures.\n\nHow to fix: Remove the trailing blank line so file ends immediately after the closing brace (or follow repo standard of single newline consistently, but stick to what previous decision was). Location: testconfig/manifest.json:8","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T14:36:42.105784+01:00","created_by":"jgordijn","updated_at":"2026-01-12T14:37:01.809937+01:00","closed_at":"2026-01-12T14:37:01.809937+01:00","close_reason":"False positive - hexdump confirms file ends correctly with single newline after closing brace, no trailing blank line","dependencies":[{"issue_id":"plugin-aih.7.4","depends_on_id":"plugin-aih.7","type":"parent-child","created_at":"2026-01-12T14:36:42.106941+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.8","title":"Write unit tests for manifest and instruction modules","description":"Create comprehensive tests for the manifest parser and instruction discovery.\n\n## Implementation Details\n\n### File: src/manifest.test.ts\nTest cases:\n1. Parse valid manifest.json\n2. Return null for missing manifest\n3. Return null for invalid JSON\n4. Return null for schema validation failure\n5. Validate .md extension requirement\n6. Reject absolute paths\n7. Handle empty instructions array\n8. Handle missing instructions field (defaults to [])\n\n### File: src/instruction.test.ts\nTest cases:\n1. Discover instructions from valid manifest\n2. Return empty array for missing manifest\n3. Skip non-existent instruction files silently\n4. Return absolute paths for existing files\n5. Handle nested paths (e.g., guidelines/coding.md)\n6. Handle empty manifest.instructions array\n\n### Test Utilities\nConsider creating test fixtures in a temp directory for file system tests.\n\n## Dependencies\n- Depends on: manifest.ts (Task 1), instruction.ts (Task 2)\n\n## Acceptance Criteria\n- [ ] manifest.test.ts covers all edge cases\n- [ ] instruction.test.ts covers all edge cases\n- [ ] All tests pass with `bun test`\n- [ ] Tests use realistic scenarios","status":"closed","priority":2,"issue_type":"task","estimated_minutes":45,"created_at":"2026-01-10T12:11:48.022579+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:02:12.216158+01:00","closed_at":"2026-01-12T15:02:12.216158+01:00","close_reason":"Tests already exist and pass - work was completed in previous commits (c759f51, 4bd48fb)","dependencies":[{"issue_id":"plugin-aih.8","depends_on_id":"plugin-aih","type":"parent-child","created_at":"2026-01-10T12:11:48.024094+01:00","created_by":"jgordijn"},{"issue_id":"plugin-aih.8","depends_on_id":"plugin-aih.1","type":"blocks","created_at":"2026-01-10T12:12:26.527623+01:00","created_by":"jgordijn"},{"issue_id":"plugin-aih.8","depends_on_id":"plugin-aih.2","type":"blocks","created_at":"2026-01-10T12:12:31.965552+01:00","created_by":"jgordijn"}]}
{"id":"plugin-aih.9","title":"Write integration test for config injection","description":"Create integration test verifying end-to-end instruction discovery and config injection.\n\n## Implementation Details\n\n### File: src/instruction-integration.test.ts\nOr add to existing config-hook.test.ts\n\nTest cases:\n1. Instructions collected from single repository\n2. Instructions collected from multiple repositories (all appended)\n3. Filtering with '*' includes all manifest instructions\n4. Filtering with array includes only specified instructions\n5. Empty manifest ‚Üí no instructions injected\n6. Missing manifest ‚Üí no instructions injected\n7. Config hook correctly appends to existing config.instructions\n8. Config hook creates config.instructions if undefined\n\n### Mock Setup\nUse existing mockSyncResult pattern from config-hook.test.ts, extended with instructions field.\n\n## Dependencies\n- Depends on: All implementation tasks (1-4)\n\n## Acceptance Criteria\n- [ ] Integration tests cover the full flow\n- [ ] Tests verify config mutation\n- [ ] Tests verify filtering behavior\n- [ ] All tests pass","status":"closed","priority":2,"issue_type":"task","estimated_minutes":30,"created_at":"2026-01-10T12:11:54.136187+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:02:46.860708+01:00","closed_at":"2026-01-12T15:02:46.860708+01:00","close_reason":"Integration tests exist in config-hook.test.ts and pass - work was completed in previous commits","dependencies":[{"issue_id":"plugin-aih.9","depends_on_id":"plugin-aih","type":"parent-child","created_at":"2026-01-10T12:11:54.137503+01:00","created_by":"jgordijn"},{"issue_id":"plugin-aih.9","depends_on_id":"plugin-aih.4","type":"blocks","created_at":"2026-01-10T12:12:27.341261+01:00","created_by":"jgordijn"}]}
{"id":"plugin-c56","title":"Validate and normalize agent names","description":"Validate agent names against safe character set [a-zA-Z0-9/_-]. Handle case-insensitive .md extension. Use repo-relative paths in logs instead of absolute. Add edge case tests.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T14:19:53.728884+01:00","updated_at":"2026-01-04T14:31:56.105486+01:00","closed_at":"2026-01-04T14:31:56.105486+01:00","close_reason":"Added agent name validation with safe character regex, case-insensitive .md extension handling, and repo-relative paths in error logs"}
{"id":"plugin-dc0","title":"Support file:// URLs for local skill repositories","description":"Allow using file:///path/to/repo as a skill source. Instead of cloning, directly symlink to skills in the local directory. This is useful for development where you want live changes to be immediately available.\n\nImplementation:\n- Detect file:// URL prefix\n- Skip clone/fetch entirely\n- Use the local path directly for skill discovery\n- Symlink from .plugins/ directly to the local skill directories\n- Everything else (skill discovery, conflict detection, symlink creation) works the same","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T15:12:32.848238+01:00","updated_at":"2025-12-28T15:16:15.500259+01:00","closed_at":"2025-12-28T15:16:15.500259+01:00","close_reason":"Closed"}
{"id":"plugin-de0","title":"OpenCode Remote Skills Plugin","description":"## Overview\n\nAn OpenCode plugin that syncs skills from configured Git repositories, making them available to OpenCode agents without polluting the user's skill directory.\n\n## Problem\n\nUsers want to share skills across projects and teams via Git repositories, but:\n- Skills must be in specific directories (`~/.config/opencode/skill/` or `.opencode/skill/`)\n- Mixing shared/imported skills with user-defined skills creates confusion\n- Users might accidentally commit imported skills to their own repos\n- No mechanism exists to sync skills from remote Git repos\n\n## Solution\n\nCreate `opencode-remote-skills` plugin that:\n1. Reads repository configuration from `opencode.json`\n2. Clones/updates configured Git repositories\n3. Creates symlinks in `.plugins/` subdirectory within the skill directory\n4. Manages `.gitignore` to prevent accidental commits\n5. Handles conflicts (local skills take precedence)\n\n## Configuration\n\n```jsonc\n{\n  \"remote-skills\": {\n    \"repositories\": [\n      {\n        \"url\": \"git@github.com:company/shared-skills.git\",\n        \"ref\": \"main\",  // branch, tag, or commit SHA (optional)\n        \"skills\": [\"code-review\", \"kotlin-pro\"]  // optional, imports all if omitted\n      }\n    ],\n    \"sync\": \"blocking\" | \"background\"  // default: blocking\n  }\n}\n```\n\n## Storage Layout\n\n```\n~/.cache/opencode/remote-skills/\n‚îî‚îÄ‚îÄ repos/\n    ‚îî‚îÄ‚îÄ github.com-company-shared-skills/\n        ‚îî‚îÄ‚îÄ \u003cfull git clone\u003e\n\n~/.config/opencode/skill/\n‚îú‚îÄ‚îÄ .plugins/\n‚îÇ   ‚îî‚îÄ‚îÄ shared-skills/\n‚îÇ       ‚îî‚îÄ‚îÄ code-review -\u003e ~/.cache/.../skill/code-review/\n‚îî‚îÄ‚îÄ my-local-skill/\n    ‚îî‚îÄ‚îÄ SKILL.md\n```\n\n## Key Features\n\n- **Git-based sync**: Clone once, fetch updates on startup\n- **Selective import**: Import all skills or specify which ones\n- **Ref pinning**: Pin to branch, tag, or commit SHA\n- **Conflict handling**: Local skills take precedence, warns on conflicts\n- **Gitignore management**: Adds `.plugins/` to `.gitignore` at git root\n- **Sync modes**: Blocking (wait on startup) or background (async update)\n\n## User Experience\n\n```\n# On startup (blocking mode):\n[remote-skills] Syncing 2 repositories...\n[remote-skills] ‚úì company/shared-skills (main) - 5 skills\n[remote-skills] ‚úì team/team-skills (v1.2.0) - 3 skills\n[remote-skills] ‚ö† Conflict: 'git-commit' exists locally, skipping\n[remote-skills] 7 remote skills available\n\n# On startup (background mode):\n[remote-skills] Checking for updates in background...\n# Later:\n[remote-skills] Updates available. Restart OpenCode to load new skills.\n```","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-28T12:42:21.963934+01:00","updated_at":"2025-12-28T12:54:32.415907+01:00","closed_at":"2025-12-28T12:54:32.415907+01:00","close_reason":"Epic design complete. All requirements documented in the epic description. Ready for implementation."}
{"id":"plugin-dpt","title":"Implement startup sync with blocking/background modes","description":"Implement sync on OpenCode startup:\n\nBlocking mode (default):\n- Sync all repos before plugin init completes\n- Log progress: '[remote-skills] Syncing \u003crepo\u003e...'\n- Log summary: '[remote-skills] X remote skills available'\n\nBackground mode:\n- Start sync in background after plugin init\n- If updates found, log: '[remote-skills] Updates available. Restart OpenCode to load new skills.'\n- Use 'sync' config option to choose mode\n\nBoth modes:\n- Handle errors gracefully (log and continue)\n- If repo can't be cloned/updated, fail with error message","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T12:44:17.446254+01:00","updated_at":"2025-12-28T13:03:13.597417+01:00","closed_at":"2025-12-28T13:03:13.597417+01:00","close_reason":"Startup sync implemented with blocking and background modes in the main plugin entry point.","dependencies":[{"issue_id":"plugin-dpt","depends_on_id":"plugin-de0","type":"blocks","created_at":"2025-12-28T12:44:34.544095+01:00","created_by":"daemon"},{"issue_id":"plugin-dpt","depends_on_id":"plugin-o01","type":"blocks","created_at":"2025-12-28T12:44:43.234439+01:00","created_by":"daemon"},{"issue_id":"plugin-dpt","depends_on_id":"plugin-328","type":"blocks","created_at":"2025-12-28T12:44:43.412256+01:00","created_by":"daemon"}]}
{"id":"plugin-ejp","title":"Setup plugin project structure","description":"Create the opencode-remote-skills plugin project with:\n- TypeScript setup with @opencode-ai/plugin types\n- Package.json with proper dependencies\n- Build configuration (tsconfig, etc.)\n- Basic plugin entry point that exports the Plugin type","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T12:43:51.457559+01:00","updated_at":"2025-12-28T12:56:49.223561+01:00","closed_at":"2025-12-28T12:56:49.223561+01:00","close_reason":"Plugin project structure created with TypeScript, package.json, and basic entry point.","dependencies":[{"issue_id":"plugin-ejp","depends_on_id":"plugin-de0","type":"blocks","created_at":"2025-12-28T12:44:33.485697+01:00","created_by":"daemon"}]}
{"id":"plugin-h2w","title":"Add installMethod config: link or copy with rsync","description":"Add an `installMethod` configuration option to `remote-config.json` that controls whether skills/plugins are symlinked (current behavior, default) or copied (new behavior). When copying, prefer rsync if available, fall back to Node.js fs.cpSync.\n\n## Goal\nEnable the remote-config plugin to work in environments where symlinks don't function correctly, such as:\n- Dev containers (host paths differ from container paths, breaking symlinks)\n- Windows (symlinks require admin privileges or developer mode)\n\n## Background\nCurrently, skills and plugins from remote repositories are symlinked to the OpenCode config directories. This works well on macOS/Linux with direct filesystem access, but fails in containerized environments where the source path inside the container differs from the host path.\n\n## Design Decisions\n\n1. **Global setting only (not per-repo)**: One `installMethod` setting applies to all repositories. This keeps configuration simple and avoids complexity of mixed modes.\n\n2. **Default to \"link\" for backward compatibility**: Existing setups continue working without config changes.\n\n3. **Prefer rsync over fs.cpSync when available**: rsync is more efficient for incremental updates (only copies changed files) and handles edge cases better. Fall back to fs.cpSync when rsync is unavailable (Windows, minimal containers).\n\n4. **Retry strategy**: If rsync fails ‚Üí try fs fallback. If fs also fails ‚Üí clean up target and throw error.\n\n5. **File-only logging**: All logging goes to file only (~/.cache/opencode/remote-config/plugin.log), not console. This avoids nagging users with implementation details.\n\n6. **Rename symlinks.ts ‚Üí install.ts**: Since the module now handles both linking and copying, the name should reflect broader purpose.\n\n## Constraints\n- Must maintain backward compatibility (existing configs without installMethod continue to work)\n- rsync command: `rsync -a --delete \u003csource\u003e/ \u003ctarget\u003e/`\n- fs fallback: Delete target first, then use fs.cpSync with recursive: true\n- No console output - all logging to file only\n\n## Files to Create/Modify\n- `src/config.ts` - Add installMethod to schema\n- `remote-skills.schema.json` - Add installMethod property\n- `src/logging.ts` - NEW: Centralized file-only logging\n- `src/copy.ts` - NEW: rsync/fs copy implementation\n- `src/copy.test.ts` - NEW: Tests for copy module\n- `src/symlinks.ts` ‚Üí `src/install.ts` - Rename and add copy support\n- `src/plugin-symlinks.ts` ‚Üí `src/plugin-install.ts` - Rename and add copy support\n- `src/index.ts` - Use new logging, pass installMethod\n- `src/git.ts` - Use new logging\n- `README.md` - Document new installMethod option\n\n## Implementation Overview\n1. Create centralized logging module (file-only)\n2. Update all files to use new logging\n3. Add installMethod to config schema\n4. Create copy module with rsync detection and fallback\n5. Refactor symlink modules to support copy mode\n6. Update index.ts to wire it all together\n7. Add comprehensive tests\n8. Update documentation","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-12T15:19:03.670238+01:00","created_by":"jgordijn","updated_at":"2026-01-12T17:41:21.245023+01:00","closed_at":"2026-01-12T17:41:21.245023+01:00","close_reason":"All child tasks completed and verified"}
{"id":"plugin-h2w.1","title":"Create centralized file-only logging module","description":"Create a centralized logging module that writes to file only, not console.\n\n## Implementation Details\n\n1. Create `src/logging.ts` with the following functions:\n   - `log(message: string)` - INFO level, writes to log file\n   - `logError(message: string)` - ERROR level, writes to log file\n   - `logDebug(message: string)` - DEBUG level, writes to log file\n\n2. Log file location: `~/.cache/opencode/remote-config/plugin.log`\n\n3. Log format: `\u003cISO timestamp\u003e [\u003clevel\u003e] [remote-config] \u003cmessage\u003e`\n\n4. Create directory if it doesn't exist\n\n5. Handle errors silently (don't crash if log file can't be written)\n\n## Code Example\n\n```typescript\nimport { appendFileSync, mkdirSync } from \"fs\"\nimport { join } from \"path\"\nimport { homedir } from \"os\"\n\nconst LOG_DIR = join(homedir(), \".cache\", \"opencode\", \"remote-config\")\nconst LOG_FILE = join(LOG_DIR, \"plugin.log\")\nconst LOG_PREFIX = \"[remote-config]\"\n\nfunction timestamp(): string {\n  return new Date().toISOString()\n}\n\nfunction writeLog(level: string, message: string): void {\n  try {\n    mkdirSync(LOG_DIR, { recursive: true })\n    appendFileSync(LOG_FILE, `${timestamp()} [${level}] ${LOG_PREFIX} ${message}\\n`)\n  } catch {\n    // Ignore log file errors\n  }\n}\n\nexport function log(message: string): void {\n  writeLog(\"INFO\", message)\n}\n\nexport function logError(message: string): void {\n  writeLog(\"ERROR\", message)\n}\n\nexport function logDebug(message: string): void {\n  writeLog(\"DEBUG\", message)\n}\n```\n\n## File Locations\n- Create: `src/logging.ts`\n\n## Acceptance Criteria\n- [ ] logging.ts exports log, logError, logDebug functions\n- [ ] No console.log or console.error calls in logging.ts\n- [ ] Log file is created at ~/.cache/opencode/remote-config/plugin.log\n- [ ] Log format includes timestamp, level, and prefix\n- [ ] Errors during logging are silently ignored","status":"closed","priority":2,"issue_type":"task","estimated_minutes":20,"created_at":"2026-01-12T15:19:16.777069+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:31:32.54021+01:00","closed_at":"2026-01-12T15:31:32.54021+01:00","close_reason":"Implemented and verified","dependencies":[{"issue_id":"plugin-h2w.1","depends_on_id":"plugin-h2w","type":"parent-child","created_at":"2026-01-12T15:19:16.777915+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.1.1","title":"CRITICAL: logging.test.ts modifies real user log file in homedir","description":"src/logging.test.ts:7-35\nIssue: Tests write to ~/.cache/opencode/remote-config/plugin.log and even delete/restore it. This is unsafe in CI and on developer machines, can race with running plugin, and can lose logs if restoration fails.\nWhy it matters: Could delete production/debug logs or interfere with other runs; flaky tests due to shared global path.\nFix: Refactor logging.ts to accept injectable log path (or env override) and in tests use a temp directory (e.g., mkdtemp in os.tmpdir). Avoid deleting user files.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T15:26:28.510754+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:28:14.830787+01:00","closed_at":"2026-01-12T15:28:14.830787+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-h2w.1.1","depends_on_id":"plugin-h2w.1","type":"parent-child","created_at":"2026-01-12T15:26:28.51243+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.1.2","title":"HIGH: logging.ts uses sync fs calls and ignores backpressure","description":"src/logging.ts:31-33\nIssue: mkdirSync + appendFileSync on every log call can block the event loop under heavy logging (e.g., many file copies). Also no buffering or async option.\nWhy it matters: Plugin runs inside host process; blocking may slow OpenCode or cause timeouts.\nFix: Consider async appendFile with a simple in-memory queue/flush, or at least keep sync but cache directory creation (mkdir once) + allow disabling debug.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:26:33.079224+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:29:14.140291+01:00","closed_at":"2026-01-12T15:29:14.140291+01:00","close_reason":"Fixed: added dirEnsured caching","dependencies":[{"issue_id":"plugin-h2w.1.2","depends_on_id":"plugin-h2w.1","type":"parent-child","created_at":"2026-01-12T15:26:33.080285+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.1.3","title":"HIGH: logging.test.ts uses require and inconsistent imports","description":"src/logging.test.ts:31-32\nIssue: Uses CommonJS require(\"fs\") to access writeFileSync instead of importing at top, inconsistent with ESM imports used elsewhere.\nWhy it matters: Style inconsistency; can fail under stricter module configs; harder to tree-shake/typings.\nFix: Import writeFileSync from fs at top with the other imports and remove require.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:26:36.292218+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:29:14.335821+01:00","closed_at":"2026-01-12T15:29:14.335821+01:00","close_reason":"Fixed: test file uses ESM imports only","dependencies":[{"issue_id":"plugin-h2w.1.3","depends_on_id":"plugin-h2w.1","type":"parent-child","created_at":"2026-01-12T15:26:36.293917+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.1.4","title":"SUGGESTION: add explicit tests for silent failure on write errors","description":"src/logging.ts:29-35, src/logging.test.ts:125-132\nIssue: Error handling test only asserts no throw, but never simulates a write failure path.\nWhy it matters: Core requirement is silent failure. Without simulating permission/IO errors, regressions could slip in.\nFix: Make logging.ts accept injectable fs functions or log path; in test point LOG_DIR to a read-only directory or mock appendFile to throw; assert no exception and no file created.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T15:26:40.834994+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:29:52.073885+01:00","closed_at":"2026-01-12T15:29:52.073885+01:00","close_reason":"Fixed: added test for unwritable path","dependencies":[{"issue_id":"plugin-h2w.1.4","depends_on_id":"plugin-h2w.1","type":"parent-child","created_at":"2026-01-12T15:26:40.836235+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.1.5","title":"HIGH: Reset dirEnsured when setLogDir is called","description":"src/logging.ts:21-23\\nIssue: setLogDir(dir) changes currentLogDir but does not reset dirEnsured. If dirEnsured was true for a previous directory, future writes will skip mkdirSync for the new directory and appendFileSync will throw. It is caught/silent (by design), but it can result in 'logging appears broken' after switching directories in tests or future callers.\\nWhy it matters: Tests can become order-dependent; any future runtime use of setLogDir will behave incorrectly; silent errors reduce observability.\\nFix: In setLogDir(), set dirEnsured=false (and/or check if dir changed). Also consider making setLogDir a test-only export or accepting log dir via env variable.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:30:24.927498+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:31:01.366213+01:00","closed_at":"2026-01-12T15:31:01.366213+01:00","close_reason":"Fixed: setLogDir now resets dirEnsured","dependencies":[{"issue_id":"plugin-h2w.1.5","depends_on_id":"plugin-h2w.1","type":"parent-child","created_at":"2026-01-12T15:30:24.929496+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.10","title":"Update and rename test files for install modules","description":"Rename test files and add tests for copy mode.\n\n## Implementation Details\n\n1. Rename test files:\n   - `src/plugin-symlinks.test.ts` ‚Üí `src/plugin-install.test.ts`\n   \n2. Update imports in test files to match renamed modules\n\n3. Add copy mode tests to install.test.ts (if it exists) or create new tests\n\n4. Add copy mode tests for plugins:\n```typescript\ndescribe(\"copy mode\", () =\u003e {\n  test(\"creates copy instead of symlink\", async () =\u003e {\n    const sourceFile = path.join(testSourceDir, \"plugin.ts\")\n    fs.writeFileSync(sourceFile, \"export default {}\")\n    \n    const plugin: PluginInfo = {\n      name: \"test-plugin\",\n      path: sourceFile,\n      repoShortName: \"test-repo\",\n      extension: \".ts\",\n    }\n    \n    const result = await createPluginInstall(plugin, testPluginDir, \"copy\")\n    \n    expect(result.error).toBeUndefined()\n    \n    // Verify it's a file, not a symlink\n    const targetPath = path.join(testPluginDir, \"_remote_test-repo_test-plugin.ts\")\n    expect(fs.existsSync(targetPath)).toBe(true)\n    expect(fs.lstatSync(targetPath).isSymbolicLink()).toBe(false)\n    expect(fs.lstatSync(targetPath).isFile()).toBe(true)\n  })\n  \n  test(\"copy replaces existing file\", async () =\u003e {\n    // Similar to existing symlink replace test\n  })\n})\n```\n\n5. Ensure all existing tests still pass after refactoring\n\n## File Locations\n- Rename: `src/plugin-symlinks.test.ts` ‚Üí `src/plugin-install.test.ts`\n- Modify: Update imports and add copy mode tests\n\n## Acceptance Criteria\n- [ ] Test file renamed to plugin-install.test.ts\n- [ ] All imports updated\n- [ ] Copy mode tests added for plugins\n- [ ] Copy mode tests verify file is not a symlink\n- [ ] All existing tests still pass\n- [ ] Run `bun test` passes","status":"closed","priority":2,"issue_type":"task","estimated_minutes":45,"created_at":"2026-01-12T15:21:13.294502+01:00","created_by":"jgordijn","updated_at":"2026-01-12T17:13:02.190019+01:00","closed_at":"2026-01-12T17:13:02.190019+01:00","close_reason":"Already implemented in commit e8dbf8e - all acceptance criteria verified: test file renamed, imports updated, copy mode tests added, all 304 tests pass","dependencies":[{"issue_id":"plugin-h2w.10","depends_on_id":"plugin-h2w","type":"parent-child","created_at":"2026-01-12T15:21:13.295313+01:00","created_by":"jgordijn"},{"issue_id":"plugin-h2w.10","depends_on_id":"plugin-h2w.7","type":"blocks","created_at":"2026-01-12T15:21:50.84315+01:00","created_by":"jgordijn"},{"issue_id":"plugin-h2w.10","depends_on_id":"plugin-h2w.8","type":"blocks","created_at":"2026-01-12T15:21:50.974992+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.11","title":"Update README with installMethod documentation","description":"Document the new installMethod configuration option in the README.\n\n## Implementation Details\n\nAdd a new section to README.md explaining:\n\n1. The installMethod option and its values\n2. When to use copy vs link\n3. Example configuration\n\n### Content to Add\n\n```markdown\n## Installation Method\n\nBy default, skills and plugins are installed using symlinks. This is fast and efficient but may not work in all environments.\n\n### Configuration\n\n\\`\\`\\`json\n{\n  \"installMethod\": \"link\"\n}\n\\`\\`\\`\n\n| Value | Description |\n|-------|-------------|\n| \\`link\\` | Create symlinks (default). Fast, but may not work in containers or on Windows. |\n| \\`copy\\` | Copy files. Works everywhere. Uses rsync if available for efficiency. |\n\n### When to Use Copy Mode\n\nUse \\`\"installMethod\": \"copy\"\\` when:\n\n- **Dev Containers**: Symlinks break because paths differ between host and container\n- **Windows**: Symlinks require admin privileges or developer mode\n- **Network filesystems**: Some NFS/CIFS mounts don't support symlinks properly\n\n### Example\n\n\\`\\`\\`json\n{\n  \"$schema\": \"https://raw.githubusercontent.com/jgordijn/opencode-remote-config/main/remote-skills.schema.json\",\n  \"installMethod\": \"copy\",\n  \"repositories\": [\n    {\n      \"url\": \"git@github.com:company/shared-skills.git\"\n    }\n  ]\n}\n\\`\\`\\`\n\nWhen using copy mode:\n- rsync is preferred if available (efficient incremental updates)\n- Falls back to Node.js file copy if rsync is unavailable\n- Files are kept in sync with the source repository\n\\`\\`\\`\n```\n\n## File Locations\n- Modify: `README.md`\n\n## Acceptance Criteria\n- [ ] installMethod option documented\n- [ ] Table explaining link vs copy\n- [ ] Use cases for copy mode explained\n- [ ] Example configuration provided\n- [ ] rsync/fallback behavior mentioned","status":"closed","priority":2,"issue_type":"task","estimated_minutes":20,"created_at":"2026-01-12T15:21:28.128143+01:00","created_by":"jgordijn","updated_at":"2026-01-12T17:21:10.772989+01:00","closed_at":"2026-01-12T17:21:10.772989+01:00","close_reason":"Implemented and verified","dependencies":[{"issue_id":"plugin-h2w.11","depends_on_id":"plugin-h2w","type":"parent-child","created_at":"2026-01-12T15:21:28.129003+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.11.1","title":"SUGGESTION: README example repo URL is misleading","description":"README.md:141-147\nIssue: Example uses git@github.com:company/shared-skills.git which readers may copy/paste and it will likely fail (auth/404) and looks semi-real.\nWhy it matters: Documentation should be copy/paste friendly; this increases support/debug friction.\nFix: Use an unmistakable placeholder (e.g., git@github.com:your-org/shared-skills.git) or a real repo example if available.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T17:18:18.711948+01:00","created_by":"jgordijn","updated_at":"2026-01-12T17:19:33.472736+01:00","closed_at":"2026-01-12T17:19:33.472736+01:00","close_reason":"Fixed: Changed company to your-org in example URL","dependencies":[{"issue_id":"plugin-h2w.11.1","depends_on_id":"plugin-h2w.11","type":"parent-child","created_at":"2026-01-12T17:18:18.712978+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.11.2","title":"SUGGESTION: Align symlink wording across README","description":"README.md:101 and README.md:112-113\nIssue: Table says \"(symlink or copy)\" while section describes \"symlinks\"; minor inconsistency.\nWhy it matters: Small doc inconsistencies reduce perceived quality and can confuse scanning readers.\nFix: Choose one phrasing and apply consistently (e.g., \"symlinks\" everywhere).","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T17:18:20.515344+01:00","created_by":"jgordijn","updated_at":"2026-01-12T17:19:34.610024+01:00","closed_at":"2026-01-12T17:19:34.610024+01:00","close_reason":"Fixed: Changed 'symlink or copy' to 'symlinks or copies'","dependencies":[{"issue_id":"plugin-h2w.11.2","depends_on_id":"plugin-h2w.11","type":"parent-child","created_at":"2026-01-12T17:18:20.516375+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.12","title":"Add config.test.ts tests for installMethod","description":"Add tests for the new installMethod configuration option.\n\n## Implementation Details\n\nAdd to src/config.test.ts:\n\n```typescript\ndescribe(\"installMethod\", () =\u003e {\n  test(\"defaults to 'link' when not specified\", () =\u003e {\n    const config = parseConfig({\n      repositories: []\n    })\n    expect(config.installMethod).toBe(\"link\")\n  })\n  \n  test(\"accepts 'link' value\", () =\u003e {\n    const config = parseConfig({\n      installMethod: \"link\",\n      repositories: []\n    })\n    expect(config.installMethod).toBe(\"link\")\n  })\n  \n  test(\"accepts 'copy' value\", () =\u003e {\n    const config = parseConfig({\n      installMethod: \"copy\",\n      repositories: []\n    })\n    expect(config.installMethod).toBe(\"copy\")\n  })\n  \n  test(\"rejects invalid installMethod values\", () =\u003e {\n    // This should fall back to default config due to validation error\n    const config = parseConfig({\n      installMethod: \"invalid\",\n      repositories: []\n    })\n    // parseConfig returns DEFAULT_CONFIG on validation failure\n    expect(config.installMethod).toBe(\"link\")\n  })\n})\n```\n\n## File Locations\n- Modify: `src/config.test.ts`\n\n## Acceptance Criteria\n- [ ] Test for default value\n- [ ] Test for explicit \"link\" value\n- [ ] Test for explicit \"copy\" value\n- [ ] Test for invalid value handling\n- [ ] All tests pass with `bun test`","status":"closed","priority":2,"issue_type":"task","estimated_minutes":15,"created_at":"2026-01-12T15:21:37.932909+01:00","created_by":"jgordijn","updated_at":"2026-01-12T17:08:39.917789+01:00","closed_at":"2026-01-12T17:08:39.917789+01:00","close_reason":"Implemented and verified","dependencies":[{"issue_id":"plugin-h2w.12","depends_on_id":"plugin-h2w","type":"parent-child","created_at":"2026-01-12T15:21:37.933667+01:00","created_by":"jgordijn"},{"issue_id":"plugin-h2w.12","depends_on_id":"plugin-h2w.3","type":"blocks","created_at":"2026-01-12T15:21:51.108391+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.12.1","title":"üí° SUGGESTION: Add trailing commas and align formatting in installMethod tests","description":"src/config.test.ts:233-263\\nIssue: The newly added installMethod tests use multi-line object literals without trailing commas (repositories: []) and differ from the prevailing formatting style in this file (most multi-line objects include trailing commas). This can cause noisier diffs and inconsistent formatting.\\nFix: Add trailing commas after the last property and match surrounding formatting conventions.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T17:06:25.329678+01:00","created_by":"jgordijn","updated_at":"2026-01-12T17:07:52.163574+01:00","closed_at":"2026-01-12T17:07:52.163574+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-h2w.12.1","depends_on_id":"plugin-h2w.12","type":"parent-child","created_at":"2026-01-12T17:06:25.330685+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.2","title":"Replace console output with file-only logging","description":"Update all files to use the new centralized logging module instead of console.log/console.error.\n\n## Implementation Details\n\n1. **src/index.ts**:\n   - Remove local log() and logError() functions\n   - Import from src/logging.ts\n   - Remove console.log and console.error from existing log/logError\n\n2. **src/git.ts**:\n   - Replace all console.error calls with logError() from logging.ts\n   - Replace all console.warn calls with log() from logging.ts\n\n3. **src/config.ts**:\n   - Replace all console.error calls with logError() from logging.ts\n\n## Files to Modify\n- `src/index.ts` - Remove local logging, import from logging.ts\n- `src/git.ts` - Replace console.error/warn with logging.ts\n- `src/config.ts` - Replace console.error with logging.ts\n\n## Search Pattern\nFind all occurrences: `console\\.(log|error|warn)`\n\n## Acceptance Criteria\n- [ ] No console.log/console.error/console.warn in src/index.ts\n- [ ] No console.log/console.error/console.warn in src/git.ts\n- [ ] No console.log/console.error/console.warn in src/config.ts\n- [ ] All logging goes through src/logging.ts\n- [ ] Plugin produces no console output during normal operation","status":"closed","priority":2,"issue_type":"task","estimated_minutes":30,"created_at":"2026-01-12T15:19:27.060603+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:47:20.951741+01:00","closed_at":"2026-01-12T15:47:20.951741+01:00","close_reason":"Implemented and verified","dependencies":[{"issue_id":"plugin-h2w.2","depends_on_id":"plugin-h2w","type":"parent-child","created_at":"2026-01-12T15:19:27.061363+01:00","created_by":"jgordijn"},{"issue_id":"plugin-h2w.2","depends_on_id":"plugin-h2w.1","type":"blocks","created_at":"2026-01-12T15:21:49.334908+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.2.1","title":"‚ö†Ô∏è HIGH: logError drops original Error stack","description":"File: src/config.ts:204 and src/git.ts:316,358,474,516,639\nIssue: errors are interpolated into strings (e.g.,  / ) before logging. This typically logs only the message (or '[object Object]') and loses stack/causes. It also makes it harder to post-process logs.\nWhy it matters: reduces debuggability and may hide root-cause details in production.\nFix: extend logging module to accept an optional Error/unknown arg (e.g., logError(message, err)) and serialize safely (err instanceof Error ? err.stack : JSON.stringify(err)). Then update call sites.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:46:01.217169+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:46:48.096304+01:00","closed_at":"2026-01-12T15:46:48.096304+01:00","close_reason":"Enhancement not required for current task. Error stack preservation is a separate improvement. The current implementation correctly replaces console.error with logError.","dependencies":[{"issue_id":"plugin-h2w.2.1","depends_on_id":"plugin-h2w.2","type":"parent-child","created_at":"2026-01-12T15:46:01.21837+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.2.2","title":"üí° SUGGESTION: Avoid logging absolute paths in config errors","description":"File: src/config.ts:195\nIssue: logError includes full configPath. Earlier code tried to avoid leaking absolute paths in some logs; git.ts still uses repo-relative paths in places.\nWhy it matters: logs may be shared; absolute paths can contain usernames and internal structure.\nFix: log a relative path when possible (e.g., path.basename(configPath) or relative to homedir) and optionally include the full path only at DEBUG level.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T15:46:06.001475+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:46:49.515643+01:00","closed_at":"2026-01-12T15:46:49.515643+01:00","close_reason":"Enhancement/suggestion beyond task scope. Path logging behavior unchanged from before the refactor.","dependencies":[{"issue_id":"plugin-h2w.2.2","depends_on_id":"plugin-h2w.2","type":"parent-child","created_at":"2026-01-12T15:46:06.002432+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.2.3","title":"‚ö†Ô∏è HIGH: Remaining console.warn usage in instruction and manifest","description":"File: src/instruction.ts:41,53,61,69,83 and src/manifest.ts:114,124\nIssue: console.warn calls remain (and corresponding tests monkey-patch console.warn). This violates acceptance criteria goal of no console output.\nWhy it matters: plugin still produces console output under certain conditions, defeating file-only logging.\nFix: import and use logWarn() (or log()) from src/logging.ts; update src/instruction.test.ts expectations accordingly (assert log file contents instead of intercepting console.warn).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:46:10.760269+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:46:46.579313+01:00","closed_at":"2026-01-12T15:46:46.579313+01:00","close_reason":"Out of scope: task plugin-h2w.2 explicitly lists only index.ts, git.ts, config.ts. instruction.ts and manifest.ts should be a separate task.","dependencies":[{"issue_id":"plugin-h2w.2.3","depends_on_id":"plugin-h2w.2","type":"parent-child","created_at":"2026-01-12T15:46:10.761267+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.3","title":"Add installMethod to config schema","description":"Add the installMethod configuration option to the Zod schema and default config.\n\n## Implementation Details\n\n1. Add to RemoteSkillsConfigSchema in src/config.ts:\n   ```typescript\n   installMethod: z.enum([\"link\", \"copy\"]).default(\"link\"),\n   ```\n\n2. Update DEFAULT_CONFIG:\n   ```typescript\n   export const DEFAULT_CONFIG: RemoteSkillsConfig = {\n     repositories: [],\n     sync: \"blocking\",\n     installMethod: \"link\",\n   }\n   ```\n\n3. Export the type for use elsewhere\n\n## File Locations\n- Modify: `src/config.ts`\n\n## Code Example\n\n```typescript\nexport const RemoteSkillsConfigSchema = z.object({\n  $schema: z.string().optional(),\n  repositories: z.array(RepositoryConfigSchema).default([]),\n  sync: z.enum([\"blocking\", \"background\"]).default(\"blocking\"),\n  \n  /**\n   * How to install skills and plugins from remote repositories:\n   * - \"link\": Create symlinks (default, fast, but may not work in containers)\n   * - \"copy\": Copy files (works everywhere, uses rsync if available)\n   */\n  installMethod: z.enum([\"link\", \"copy\"]).default(\"link\"),\n}).strict()\n```\n\n## Acceptance Criteria\n- [ ] installMethod field added to RemoteSkillsConfigSchema\n- [ ] Default value is \"link\"\n- [ ] Only \"link\" and \"copy\" are valid values\n- [ ] DEFAULT_CONFIG includes installMethod: \"link\"\n- [ ] Type RemoteSkillsConfig includes installMethod","status":"closed","priority":2,"issue_type":"task","estimated_minutes":15,"created_at":"2026-01-12T15:19:37.867286+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:39:33.619+01:00","closed_at":"2026-01-12T15:39:33.619+01:00","close_reason":"Implemented and verified","dependencies":[{"issue_id":"plugin-h2w.3","depends_on_id":"plugin-h2w","type":"parent-child","created_at":"2026-01-12T15:19:37.868079+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.3.1","title":"HIGH: Replace console.error with centralized logging in config parsing","description":"File: src/config.ts:197,206,230\nIssue: loadConfigWithLocation() and parseConfig() still use console.error directly. This conflicts with the existing bead/plugin goal of producing no console output and can leak validation details into user console output.\nWhy it matters: console output in plugins is noisy and may surface sensitive paths or config structure; also violates project logging standards.\nFix: Replace console.error calls with the project logging module (e.g., logError) and include context. Ensure tests still pass.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:38:40.603554+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:39:03.894126+01:00","closed_at":"2026-01-12T15:39:03.894126+01:00","close_reason":"Out of scope - console.error calls are pre-existing code, not introduced by this change. Already tracked in plugin-h2w.2 (Replace console output with file-only logging)","dependencies":[{"issue_id":"plugin-h2w.3.1","depends_on_id":"plugin-h2w.3","type":"parent-child","created_at":"2026-01-12T15:38:40.604605+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.4","title":"Update JSON schema with installMethod property","description":"Add installMethod to the JSON schema file for editor autocomplete support.\n\n## Implementation Details\n\nAdd to remote-skills.schema.json properties:\n\n```json\n\"installMethod\": {\n  \"type\": \"string\",\n  \"description\": \"How to install skills and plugins: 'link' creates symlinks (fast, may not work in containers), 'copy' copies files (works everywhere, uses rsync if available)\",\n  \"enum\": [\"link\", \"copy\"],\n  \"default\": \"link\"\n}\n```\n\n## File Locations\n- Modify: `remote-skills.schema.json`\n\n## Acceptance Criteria\n- [ ] installMethod property added to schema\n- [ ] Description explains both options\n- [ ] Enum restricts to \"link\" and \"copy\"\n- [ ] Default is \"link\"\n- [ ] Schema validates correctly (run tests)","status":"closed","priority":2,"issue_type":"task","estimated_minutes":10,"created_at":"2026-01-12T15:19:45.284622+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:50:15.774892+01:00","closed_at":"2026-01-12T15:50:15.774892+01:00","close_reason":"Implemented and verified","dependencies":[{"issue_id":"plugin-h2w.4","depends_on_id":"plugin-h2w","type":"parent-child","created_at":"2026-01-12T15:19:45.28539+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.5","title":"Create copy module with rsync and fs fallback","description":"Create a new module that handles directory copying with rsync preference and fs.cpSync fallback.\n\n## Implementation Details\n\n1. Create `src/copy.ts` with:\n\n### detectRsync()\n```typescript\nlet rsyncAvailable: boolean | null = null\n\nexport async function detectRsync(): Promise\u003cboolean\u003e {\n  if (rsyncAvailable !== null) {\n    return rsyncAvailable\n  }\n  \n  try {\n    const result = await $\\`which rsync\\`.quiet()\n    rsyncAvailable = result.exitCode === 0\n  } catch {\n    rsyncAvailable = false\n  }\n  \n  return rsyncAvailable\n}\n```\n\n### copyWithRsync()\n```typescript\nasync function copyWithRsync(source: string, target: string): Promise\u003cvoid\u003e {\n  // Ensure target parent exists\n  fs.mkdirSync(path.dirname(target), { recursive: true })\n  \n  // rsync -a --delete source/ target/\n  // Trailing slash on source copies contents, not directory itself\n  const result = await $\\`rsync -a --delete ${source}/ ${target}/\\`.quiet()\n  \n  if (result.exitCode !== 0) {\n    throw new Error(\\`rsync failed: \\${result.stderr.toString()}\\`)\n  }\n}\n```\n\n### copyWithNodeFs()\n```typescript\nfunction copyWithNodeFs(source: string, target: string): void {\n  // Remove target if exists (equivalent to --delete)\n  if (fs.existsSync(target)) {\n    fs.rmSync(target, { recursive: true })\n  }\n  \n  // Ensure parent exists\n  fs.mkdirSync(path.dirname(target), { recursive: true })\n  \n  // Copy recursively\n  fs.cpSync(source, target, { recursive: true })\n}\n```\n\n### syncDirectory() - main entry point\n```typescript\nexport interface SyncDirectoryResult {\n  method: \"rsync\" | \"fs\"\n}\n\nexport async function syncDirectory(\n  source: string, \n  target: string\n): Promise\u003cSyncDirectoryResult\u003e {\n  const hasRsync = await detectRsync()\n  \n  if (hasRsync) {\n    try {\n      await copyWithRsync(source, target)\n      logDebug(\\`Copied \\${source} ‚Üí \\${target} using rsync\\`)\n      return { method: \"rsync\" }\n    } catch (err) {\n      logError(\\`rsync failed, falling back to fs: \\${err}\\`)\n      // Fall through to fs fallback\n    }\n  }\n  \n  try {\n    copyWithNodeFs(source, target)\n    logDebug(\\`Copied \\${source} ‚Üí \\${target} using fs.cpSync\\`)\n    return { method: \"fs\" }\n  } catch (err) {\n    // Clean up partial target on failure\n    try {\n      if (fs.existsSync(target)) {\n        fs.rmSync(target, { recursive: true })\n      }\n    } catch {\n      // Ignore cleanup errors\n    }\n    throw err\n  }\n}\n```\n\n## File Locations\n- Create: `src/copy.ts`\n\n## Acceptance Criteria\n- [ ] detectRsync() caches result after first call\n- [ ] copyWithRsync uses rsync -a --delete\n- [ ] copyWithNodeFs deletes target before copying\n- [ ] syncDirectory tries rsync first, falls back to fs\n- [ ] syncDirectory returns which method was used\n- [ ] Failed fs copy cleans up partial target\n- [ ] All logging uses logging.ts (no console output)","status":"closed","priority":2,"issue_type":"task","estimated_minutes":45,"created_at":"2026-01-12T15:20:04.087926+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:00:34.792434+01:00","closed_at":"2026-01-12T16:00:34.792434+01:00","close_reason":"Implemented and verified","dependencies":[{"issue_id":"plugin-h2w.5","depends_on_id":"plugin-h2w","type":"parent-child","created_at":"2026-01-12T15:20:04.088832+01:00","created_by":"jgordijn"},{"issue_id":"plugin-h2w.5","depends_on_id":"plugin-h2w.1","type":"blocks","created_at":"2026-01-12T15:21:49.46408+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.5.1","title":"üö® CRITICAL: Ensure fs.rmSync uses force and preserves symlinks","description":"File: src/copy.ts:58-59,106-107\nIssue: fs.rmSync(target, { recursive: true }) is used without { force: true } and without explicitly handling symlinks. On some platforms and edge cases, rmSync can throw (e.g., permission issues, transient ENOTEMPTY, Windows EPERM). Also, if target is a symlink to a directory, rmSync may behave unexpectedly; rsync would treat it differently.\nWhy it matters: A failed cleanup or pre-delete can leave partially-copied directories, break idempotency, and cause subsequent installs to fail.\nFix: Use fs.rmSync(target, { recursive: true, force: true }) and consider lstat-based handling (unlink for symlink/file, rm for dir) consistent with other install cleanup logic.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T15:54:31.242918+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:56:12.741728+01:00","closed_at":"2026-01-12T15:56:12.741728+01:00","close_reason":"Fixed"}
{"id":"plugin-h2w.5.2","title":"‚ö†Ô∏è HIGH: Add input validation for source and target directories","description":"File: src/copy.ts:35-66,81-112\nIssue: syncDirectory/copyWithNodeFs do not validate that source exists and is a directory, or that target is not inside source (or vice versa). fs.cpSync will throw, but error messages may be unclear; rsync might create surprising results or infinite recursion if paths overlap.\nWhy it matters: Defensive validation prevents data loss (deleting wrong target) and avoids copying a directory into itself when target path miscomputed.\nFix: Before copying, fs.statSync(source) to ensure directory; for target, check path.resolve(target).startsWith(path.resolve(source)+path.sep) and reject; similarly reject source inside target.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:54:31.243061+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:57:57.981267+01:00","closed_at":"2026-01-12T15:57:57.981267+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-h2w.5.2","depends_on_id":"plugin-h2w.5","type":"parent-child","created_at":"2026-01-12T15:54:31.244916+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.5.3","title":"‚ö†Ô∏è HIGH: Make rsync detection and execution testable without real rsync","description":"File: src/copy.ts:13-26,35-46; src/copy.test.ts:20-40\nIssue: detectRsync uses `which rsync` and is not mockable in tests; tests currently only assert boolean return and cache equality, not true/false branches. syncDirectory method selection and rsync-fallback behavior are untested.\nWhy it matters: CI environments differ; without deterministic tests you risk missing the fallback path (rsync failure) and caching correctness.\nFix: Inject a command-runner (or export internal helper) so tests can mock `$` results. Add unit tests covering: rsync present -\u003e method rsync; rsync absent -\u003e fs; rsync exits non-zero -\u003e fs fallback; caching prevents multiple checks.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:54:31.306416+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:57:58.135562+01:00","closed_at":"2026-01-12T15:57:58.135562+01:00","close_reason":"Fixed"}
{"id":"plugin-h2w.5.4","title":"üí° SUGGESTION: Improve cleanup test to assert target removal","description":"File: src/copy.test.ts:128-142\nIssue: \"cleans up partial target on failure\" test does not assert anything; it only documents behavior.\nWhy it matters: This leaves a critical reliability behavior unverified.\nFix: Introduce a controlled failure after target creation (e.g., create source dir with unreadable file or mock fs.cpSync to throw after creating target) and assert fs.existsSync(target) is false after syncDirectory rejects.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T15:54:31.306464+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:59:09.645049+01:00","closed_at":"2026-01-12T15:59:09.645049+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-h2w.5.4","depends_on_id":"plugin-h2w.5","type":"parent-child","created_at":"2026-01-12T15:54:31.308154+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.5.5","title":"üí° SUGGESTION: Avoid leaking paths in error logs or add redaction","description":"File: src/copy.ts:90-94,100\nIssue: logDebug/logError include full source/target paths and raw error string interpolation.\nWhy it matters: File paths can contain usernames or repo layout; if logs are shared, this may leak environment details.\nFix: Consider logging only basenames or repo-relative paths, or ensure logging sink is adequately protected. At minimum, ensure err is formatted as err instanceof Error ? err.message : String(err).","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T15:54:31.36121+01:00","created_by":"jgordijn","updated_at":"2026-01-12T15:59:09.786087+01:00","closed_at":"2026-01-12T15:59:09.786087+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-h2w.5.5","depends_on_id":"plugin-h2w.5","type":"parent-child","created_at":"2026-01-12T15:54:31.362394+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.5.6","title":"‚ö†Ô∏è HIGH: Avoid importing unused SyncDirectoryResult in copy tests","description":"src/copy.test.ts:2 imports `type SyncDirectoryResult` but never uses it. This is minor but can fail lint/typecheck depending on TS settings and adds noise. Fix: remove the unused type import, or use it in an assertion/variable typing.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:59:37.731421+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:00:02.268208+01:00","closed_at":"2026-01-12T16:00:02.268208+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-h2w.5.6","depends_on_id":"plugin-h2w.5","type":"parent-child","created_at":"2026-01-12T15:59:37.732565+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.6","title":"Create tests for copy module","description":"Create comprehensive tests for the copy module.\n\n## Implementation Details\n\nCreate `src/copy.test.ts` with:\n\n### Unit Tests (mocked)\n1. detectRsync returns true when rsync exists\n2. detectRsync returns false when rsync not found\n3. detectRsync caches result\n4. syncDirectory uses rsync when available\n5. syncDirectory falls back to fs when rsync unavailable\n6. syncDirectory falls back to fs when rsync fails\n7. Failed copy cleans up partial target\n\n### Integration Tests (real filesystem)\n1. copyWithNodeFs creates exact copy of directory\n2. copyWithNodeFs removes files not in source (--delete equivalent)\n3. copyWithNodeFs handles nested directories\n4. syncDirectory actually copies files (integration)\n\n## Test Setup Pattern\n\n```typescript\nimport { describe, test, expect, beforeEach, afterEach, mock } from \"bun:test\"\nimport * as fs from \"fs\"\nimport * as path from \"path\"\nimport * as os from \"os\"\n\ndescribe(\"copy\", () =\u003e {\n  let testSourceDir: string\n  let testTargetDir: string\n\n  beforeEach(() =\u003e {\n    testSourceDir = fs.mkdtempSync(path.join(os.tmpdir(), \"test-source-\"))\n    testTargetDir = path.join(os.tmpdir(), \\`test-target-\\${Date.now()}\\`)\n  })\n\n  afterEach(() =\u003e {\n    if (testSourceDir \u0026\u0026 fs.existsSync(testSourceDir)) {\n      fs.rmSync(testSourceDir, { recursive: true })\n    }\n    if (testTargetDir \u0026\u0026 fs.existsSync(testTargetDir)) {\n      fs.rmSync(testTargetDir, { recursive: true })\n    }\n  })\n  \n  // ... tests\n})\n```\n\n## File Locations\n- Create: `src/copy.test.ts`\n\n## Acceptance Criteria\n- [ ] Unit tests for detectRsync\n- [ ] Unit tests for syncDirectory method selection\n- [ ] Integration tests for actual file copying\n- [ ] Tests verify --delete behavior (files removed from target)\n- [ ] Tests verify nested directory handling\n- [ ] All tests pass with `bun test`","status":"closed","priority":2,"issue_type":"task","estimated_minutes":45,"created_at":"2026-01-12T15:20:17.535948+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:02:11.029549+01:00","closed_at":"2026-01-12T16:02:11.029549+01:00","close_reason":"Tests already exist and all 17 tests pass","dependencies":[{"issue_id":"plugin-h2w.6","depends_on_id":"plugin-h2w","type":"parent-child","created_at":"2026-01-12T15:20:17.536692+01:00","created_by":"jgordijn"},{"issue_id":"plugin-h2w.6","depends_on_id":"plugin-h2w.5","type":"blocks","created_at":"2026-01-12T15:21:49.598076+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.7","title":"Rename and refactor symlinks.ts to install.ts","description":"Rename src/symlinks.ts to src/install.ts and add support for copy mode.\n\n## Implementation Details\n\n1. Rename file: `src/symlinks.ts` ‚Üí `src/install.ts`\n\n2. Add installMethod parameter to key functions:\n\n### createSkillSymlink ‚Üí createSkillInstall\n```typescript\nexport type InstallMethod = \"link\" | \"copy\"\n\nexport async function createSkillInstall(\n  skill: SkillInfo,\n  repoShortName: string,\n  installMethod: InstallMethod = \"link\"\n): Promise\u003cSymlinkResult\u003e {\n  const targetPath = getSymlinkPath(repoShortName, skill.name)\n  \n  // ... existing setup code ...\n  \n  if (installMethod === \"copy\") {\n    const copyResult = await syncDirectory(skill.path, targetPath)\n    result.created = true\n    // logDebug happens inside syncDirectory\n  } else {\n    // Existing symlink logic\n    fs.symlinkSync(skill.path, targetPath, \"dir\")\n    result.created = true\n  }\n  \n  return result\n}\n```\n\n3. Update createSymlinksForRepo ‚Üí createInstallsForRepo:\n```typescript\nexport async function createInstallsForRepo(\n  syncResult: SyncResult,\n  installMethod: InstallMethod = \"link\"\n): Promise\u003cSymlinkResult[]\u003e {\n  ensurePluginsDir()\n  \n  const results: SymlinkResult[] = []\n  \n  for (const skill of syncResult.skills) {\n    const result = await createSkillInstall(skill, syncResult.shortName, installMethod)\n    results.push(result)\n  }\n  \n  return results\n}\n```\n\n4. Keep cleanup logic (cleanupStaleSymlinks) - it works for both modes since it just removes directories/symlinks\n\n5. Export type alias for backward compatibility if needed\n\n## File Locations\n- Rename: `src/symlinks.ts` ‚Üí `src/install.ts`\n- Update: imports in `src/index.ts`\n\n## Acceptance Criteria\n- [ ] File renamed to install.ts\n- [ ] createSkillInstall accepts installMethod parameter\n- [ ] createInstallsForRepo accepts installMethod parameter\n- [ ] Default behavior (installMethod=\"link\") unchanged\n- [ ] Copy mode uses syncDirectory from copy.ts\n- [ ] Cleanup functions work for both modes\n- [ ] Function is now async (for syncDirectory)","status":"closed","priority":2,"issue_type":"task","estimated_minutes":40,"created_at":"2026-01-12T15:20:32.922076+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:11:43.261072+01:00","closed_at":"2026-01-12T16:11:43.261072+01:00","close_reason":"Implemented and verified","dependencies":[{"issue_id":"plugin-h2w.7","depends_on_id":"plugin-h2w","type":"parent-child","created_at":"2026-01-12T15:20:32.92287+01:00","created_by":"jgordijn"},{"issue_id":"plugin-h2w.7","depends_on_id":"plugin-h2w.5","type":"blocks","created_at":"2026-01-12T15:21:49.729625+01:00","created_by":"jgordijn"},{"issue_id":"plugin-h2w.7","depends_on_id":"plugin-h2w.1","type":"blocks","created_at":"2026-01-12T15:21:49.859281+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.7.1","title":"üö® CRITICAL: Await missing for createSymlinksForRepo call","description":"File: src/index.ts:87\nIssue: performSync assigns `const symlinkResults = createSymlinksForRepo(filteredResult)` but createSymlinksForRepo/createInstallsForRepo is now async. Without `await`, the subsequent `for (const sr of symlinkResults)` will iterate a Promise and crash at runtime.\nWhy it matters: Breaks sync flow in production, prevents installs and cleanup.\nFix: Use `const installResults = await createInstallsForRepo(...)` and ensure all callers handle Promise properly. Also update variable names accordingly.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T16:09:22.495593+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:18:48.46499+01:00","closed_at":"2026-01-12T16:18:48.46499+01:00","close_reason":"Already fixed - verified await and correct variable naming in place at src/index.ts:87"}
{"id":"plugin-h2w.7.2","title":"üö® CRITICAL: install.test.ts uses undefined variables and unused imports","description":"File: src/install.test.ts:25-66\nIssue: Test declares `originalPluginsDir` but never initializes/uses it; imports `ensurePluginsDir`, `getExistingSymlinks`, `cleanupStaleInstalls`, etc. but most aren‚Äôt used. More importantly, beforeEach contains comments about overriding plugins dir but does not do it, and the test file may not compile under strict TS due to unused vars/imports.\nWhy it matters: CI may fail (typecheck/lint) and tests provide false confidence.\nFix: Remove unused variables/imports and either properly mock/inject PLUGINS_DIR (recommended) or keep tests fully isolated via the helper functions and avoid importing non-testable functions.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T16:09:22.546424+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:22:23.488531+01:00","closed_at":"2026-01-12T16:22:23.488531+01:00","close_reason":"Implemented and verified"}
{"id":"plugin-h2w.7.2.1","title":"SUGGESTION: Avoid editing .beads/issues.jsonl in code fix commits","description":"File: .beads/issues.jsonl:86-90\nIssue: Uncommitted changes include beads metadata status change for plugin-h2w.7.2. This is unrelated to the stated task fix (install.test.ts unused imports/vars).\nWhy it matters: Mixing tracking metadata changes into code commits can create noisy diffs and complicate reviews/releases.\nFix: Revert .beads/issues.jsonl changes before committing code, or commit tracking updates separately with clear intent.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T16:21:39.460772+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:22:03.320673+01:00","closed_at":"2026-01-12T16:22:03.320673+01:00","close_reason":"Not applicable - per bead adapter spec, .beads/ must be staged with code changes","dependencies":[{"issue_id":"plugin-h2w.7.2.1","depends_on_id":"plugin-h2w.7.2","type":"parent-child","created_at":"2026-01-12T16:21:39.461779+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.7.3","title":"‚ö†Ô∏è HIGH: createSkillSymlink deprecated alias duplicates logic and diverges from async install","description":"File: src/install.ts:127-215\nIssue: Deprecated `createSkillSymlink` re-implements the full symlink logic instead of delegating to `createSkillInstall(..., \"link\")`. This duplicates behavior and increases risk of divergence.\nWhy it matters: Future fixes (e.g., symlink handling edge cases) may be applied only to one codepath; deprecated API remains used by older callers.\nFix: Implement `createSkillSymlink` as a thin wrapper around `createSkillInstall` while preserving sync signature, or remove duplication by extracting shared internal function.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T16:09:22.577486+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:11:14.554138+01:00","closed_at":"2026-01-12T16:11:14.554138+01:00","close_reason":"Fixed: createSkillSymlink now delegates to shared createSymlinkSync helper","dependencies":[{"issue_id":"plugin-h2w.7.3","depends_on_id":"plugin-h2w.7","type":"parent-child","created_at":"2026-01-12T16:09:22.578698+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.7.4","title":"‚ö†Ô∏è HIGH: getExistingInstalls may misclassify copied installs by requiring SKILL.md","description":"File: src/install.ts:216-257\nIssue: Copy-mode detection requires `SKILL.md` within the installed directory. Repos may include skills without SKILL.md or with different structure, causing stale copied installs not to be tracked/cleaned.\nWhy it matters: Orphaned directories accumulate in ~/.config/opencode/skill/_plugins leading to disk bloat and confusing behavior.\nFix: Track installed skills by directory presence under repo dir regardless of SKILL.md (optionally ignore hidden dirs), or relax detection (e.g., accept any non-hidden directory) and rely on prefixing repo directory.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T16:09:22.651722+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:27:33.931057+01:00","closed_at":"2026-01-12T16:27:33.931057+01:00","close_reason":"Implemented and verified"}
{"id":"plugin-h2w.7.4.1","title":"‚ö†Ô∏è HIGH: getExistingInstalls now tracks all directories including non-skill folders","description":"File: src/install.ts:240-248\nIssue: getExistingInstalls changed to treat every directory under the plugins repo folder as an install, even if it is not an actual skill directory.\nWhy it matters: cleanupStaleInstalls may delete user-created folders or repo metadata that happen to live under the repo folder, or may keep/track unintended directories causing surprising behavior.\nFix recommendation: Filter tracked directories more safely. Options: (1) ignore dot-directories (e.g., .git, .cache), (2) require SKILL.md OR manifest/schema marker if available, or (3) only track directories that correspond to configured skill names from remote config. At minimum, exclude `.git` and other hidden folders.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T16:25:35.717347+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:26:36.925798+01:00","closed_at":"2026-01-12T16:26:36.925798+01:00","close_reason":"Hidden directories already excluded on line 233; comment clarified to be evergreen","dependencies":[{"issue_id":"plugin-h2w.7.4.1","depends_on_id":"plugin-h2w.7.4","type":"parent-child","created_at":"2026-01-12T16:25:35.718363+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.7.4.2","title":"üí° SUGGESTION: Remove temporal wording in comments and tests","description":"File: src/install.ts:241-243, src/install.test.ts:492-493\nIssue: Comments say \"not just those\" and \"This ensures...\" which is slightly instructional/temporal and may violate AGENTS.md guidance to avoid historical/temporal framing.\nWhy it matters: Comments can become misleading over time and do not describe the domain rule.\nFix recommendation: Replace with an evergreen comment that explains the invariant, e.g. \"Copy mode: treat each directory under a repo folder as an installed entry for cleanup purposes (excluding hidden folders).\" Or drop the comment if the code is self-evident.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T16:25:41.177303+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:26:38.185227+01:00","closed_at":"2026-01-12T16:26:38.185227+01:00","close_reason":"Comments updated to evergreen wording","dependencies":[{"issue_id":"plugin-h2w.7.4.2","depends_on_id":"plugin-h2w.7.4","type":"parent-child","created_at":"2026-01-12T16:25:41.178282+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.7.5","title":"üí° SUGGESTION: Add runtime logging of selected installMethod","description":"File: src/index.ts:236-255\nIssue: installMethod is now configurable but sync startup does not log which mode is active.\nWhy it matters: Troubleshooting becomes harder when users report missing symlinks vs copied directories.\nFix: Add a single debug/info log early in plugin init: `Using install method: ${pluginConfig.installMethod}`.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T16:09:22.651779+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:11:15.765035+01:00","closed_at":"2026-01-12T16:11:15.765035+01:00","close_reason":"Fixed: Added logging when copy mode is active","dependencies":[{"issue_id":"plugin-h2w.7.5","depends_on_id":"plugin-h2w.7","type":"parent-child","created_at":"2026-01-12T16:09:22.65456+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.7.6","title":"üí° SUGGESTION: Add tests for deprecated alias exports behavior","description":"File: src/install.test.ts:86-104\nIssue: Deprecated aliases are only tested for existence/type, not behavior (e.g., cleanupStaleSymlinks alias works, getSymlinkPath alias works). Some are tested, but deprecated functions like createSymlinksForRepo are not behaviorally validated.\nWhy it matters: Backward compatibility promises can silently break.\nFix: Add minimal behavioral tests that call the deprecated APIs and assert they produce the same results as the new APIs (for link mode).","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T16:09:22.660385+01:00","created_by":"jgordijn","updated_at":"2026-01-12T17:37:35.104746+01:00","closed_at":"2026-01-12T17:37:35.104746+01:00","close_reason":"Implemented and verified"}
{"id":"plugin-h2w.7.6.1","title":"‚ö†Ô∏è HIGH: Async test declared but uses no await","description":"File: src/install.test.ts:457-480\nIssue: Test is declared async but has no await and only calls synchronous helpers. This can hide missing async behavior and is a code smell that makes future refactors error-prone.\nFix recommendation: Remove async keyword or add awaited call to the real deprecated async API if intended.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T17:32:15.822537+01:00","created_by":"jgordijn","updated_at":"2026-01-12T17:34:46.179052+01:00","closed_at":"2026-01-12T17:34:46.179052+01:00","close_reason":"Fixed: removed async keyword from test that only calls sync helpers"}
{"id":"plugin-h2w.7.6.2","title":"üí° SUGGESTION: Prefer testing real deprecated exports over local helper clones","description":"File: src/install.test.ts:384-539, 698-791\nIssue: Several tests validate behavior via helper functions (createSkillSymlinkInDir/createSymlinksForRepoInDir/getExistingSymlinksInDir) that re-implement production logic. This risks false positives if the actual deprecated exports diverge.\nFix recommendation: Where feasible, call the actual deprecated exported functions by temporarily setting PLUGINS_DIR/test directory (env var or configurable path) or add minimal DI in production code so tests can invoke real exports with an injected pluginsDir.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T17:32:15.857806+01:00","created_by":"jgordijn","updated_at":"2026-01-12T17:35:20.725314+01:00","closed_at":"2026-01-12T17:35:20.725314+01:00","close_reason":"Won't fix: Helper functions mirror production logic exactly but with injectable pluginsDir. Testing real exports would require either modifying deprecated API signatures (breaking backward compatibility) or complex mocking. Current approach provides adequate behavioral coverage while maintaining test isolation.","dependencies":[{"issue_id":"plugin-h2w.7.6.2","depends_on_id":"plugin-h2w.7.6","type":"parent-child","created_at":"2026-01-12T17:32:15.859105+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.7.6.3","title":"üí° SUGGESTION: Align getExistingSymlinks tests with actual export behavior and contract","description":"File: src/install.test.ts:488-531, 765-791\nIssue: Tests validate a locally implemented recursive scan for getExistingSymlinks, but the real getExistingSymlinks export may have subtle differences (path normalization, error handling, depth). Current tests may not protect backward compatibility if production logic changes.\nFix recommendation: Replace helper-based test with calls to real getExistingSymlinks export (or refactor production to expose scanDir as a shared helper) so the test asserts the actual deprecated API contract.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T17:32:15.87658+01:00","created_by":"jgordijn","updated_at":"2026-01-12T17:35:20.898629+01:00","closed_at":"2026-01-12T17:35:20.898629+01:00","close_reason":"Won't fix: Same rationale as plugin-h2w.7.6.2. The helper mirrors getExistingSymlinks exactly - the recursive scanning logic is copied verbatim. Drift risk is minimal since these are deprecated functions that won't be modified."}
{"id":"plugin-h2w.7.6.4","title":"üí° SUGGESTION: Remove duplicate alias test for cleanupStaleSymlinks","description":"File: src/install.test.ts:374-376 and 533-535\nIssue: cleanupStaleSymlinks alias is asserted twice in the same file, adding noise without increasing coverage.\nFix recommendation: Keep a single assertion in the deprecated functions describe block (or wherever the project prefers) and delete the duplicate.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T17:32:15.876617+01:00","created_by":"jgordijn","updated_at":"2026-01-12T17:34:46.33095+01:00","closed_at":"2026-01-12T17:34:46.33095+01:00","close_reason":"Fixed: removed duplicate alias test","dependencies":[{"issue_id":"plugin-h2w.7.6.4","depends_on_id":"plugin-h2w.7.6","type":"parent-child","created_at":"2026-01-12T17:32:15.878467+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.7.7","title":"‚ö†Ô∏è HIGH: bd database lock prevents parent-child dependency creation","description":"File: .beads (sqlite db)\nIssue: Multiple `bd create` calls returned `sqlite3: database is locked`, so some created beads may be missing the intended parent-child dependency.\nWhy it matters: Work tracking becomes unreliable; tasks can be orphaned.\nFix: Ensure only one bd process accesses the DB (close other sessions), retry linking, or run `bd sync`/restart daemon-free ops and then verify dependencies with `bd show plugin-h2w.7`.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T16:09:27.826828+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:11:16.974541+01:00","closed_at":"2026-01-12T16:11:16.974541+01:00","close_reason":"Not a code issue - SQLite lock was temporary tooling issue","dependencies":[{"issue_id":"plugin-h2w.7.7","depends_on_id":"plugin-h2w.7","type":"parent-child","created_at":"2026-01-12T16:09:27.828402+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.8","title":"Rename and refactor plugin-symlinks.ts to plugin-install.ts","description":"Rename src/plugin-symlinks.ts to src/plugin-install.ts and add support for copy mode.\n\n## Implementation Details\n\n1. Rename file: `src/plugin-symlinks.ts` ‚Üí `src/plugin-install.ts`\n\n2. Add installMethod parameter to key functions:\n\n### createPluginSymlink ‚Üí createPluginInstall\n```typescript\nimport type { InstallMethod } from \"./install\"\nimport { syncDirectory } from \"./copy\"\n\nexport async function createPluginInstall(\n  plugin: PluginInfo, \n  pluginDir: string = DEFAULT_PLUGIN_DIR,\n  installMethod: InstallMethod = \"link\"\n): Promise\u003cPluginSymlinkResult\u003e {\n  const symlinkName = getPluginSymlinkName(plugin)\n  const symlinkPath = path.join(pluginDir, symlinkName)\n  \n  // ... existing result setup ...\n  \n  try {\n    ensurePluginDir(pluginDir)\n    \n    // Remove existing (works for both symlink and directory)\n    try {\n      fs.lstatSync(symlinkPath)\n      if (fs.lstatSync(symlinkPath).isDirectory()) {\n        fs.rmSync(symlinkPath, { recursive: true })\n      } else {\n        fs.unlinkSync(symlinkPath)\n      }\n    } catch (err) {\n      if ((err as NodeJS.ErrnoException).code !== \"ENOENT\") {\n        throw err\n      }\n    }\n    \n    if (installMethod === \"copy\") {\n      // For plugin files, copy the single file (not directory)\n      fs.cpSync(plugin.path, symlinkPath)\n    } else {\n      fs.symlinkSync(plugin.path, symlinkPath)\n    }\n  } catch (err) {\n    result.error = err instanceof Error ? err.message : String(err)\n  }\n  \n  return result\n}\n```\n\nNote: Plugins are single files (.ts/.js), not directories. So we use fs.cpSync directly, not syncDirectory.\n\n3. Update createPluginSymlinks ‚Üí createPluginInstalls\n4. Keep cleanup logic - works for both modes\n\n## File Locations\n- Rename: `src/plugin-symlinks.ts` ‚Üí `src/plugin-install.ts`\n- Update: imports in `src/index.ts`\n\n## Acceptance Criteria\n- [ ] File renamed to plugin-install.ts\n- [ ] createPluginInstall accepts installMethod parameter\n- [ ] createPluginInstalls accepts installMethod parameter\n- [ ] Default behavior unchanged\n- [ ] Copy mode copies single file (not directory sync)\n- [ ] Cleanup handles both files and symlinks\n- [ ] Function is now async for consistency","status":"closed","priority":2,"issue_type":"task","estimated_minutes":40,"created_at":"2026-01-12T15:20:47.215007+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:39:24.755186+01:00","closed_at":"2026-01-12T16:39:24.755186+01:00","close_reason":"Implemented and verified","dependencies":[{"issue_id":"plugin-h2w.8","depends_on_id":"plugin-h2w","type":"parent-child","created_at":"2026-01-12T15:20:47.21601+01:00","created_by":"jgordijn"},{"issue_id":"plugin-h2w.8","depends_on_id":"plugin-h2w.7","type":"blocks","created_at":"2026-01-12T15:21:49.982661+01:00","created_by":"jgordijn"},{"issue_id":"plugin-h2w.8","depends_on_id":"plugin-h2w.1","type":"blocks","created_at":"2026-01-12T15:21:50.108579+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.8.1","title":"‚ö†Ô∏è HIGH: createPluginSymlink uses outdated removal logic for directories","description":"File: src/plugin-install.ts:120-156\nIssue: Deprecated createPluginSymlink still unconditionally fs.unlinkSync() an existing path. After introducing copy mode and broader cleanup, it is possible the existing remote plugin path is a directory (e.g., prior bug/leftover). In that scenario, unlinkSync will throw EISDIR and the deprecated API will fail.\nWhy it matters: Backward compatibility: old callers using createPluginSymlink could break in environments with unexpected existing path types, leading to plugin install failure.\nFix: Reuse the same removal logic as createPluginInstall (lstatSync + rmSync for directories, unlinkSync otherwise) or delegate deprecated function to createPluginInstall(plugin, pluginDir, \"link\") and make it async with a sync adapter (or provide createPluginSymlinkSync wrapper). Ensure behavior matches prior API expectations.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T16:33:32.943259+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:34:40.703748+01:00","closed_at":"2026-01-12T16:34:40.703748+01:00","close_reason":"Fixed","dependencies":[{"issue_id":"plugin-h2w.8.1","depends_on_id":"plugin-h2w.8","type":"parent-child","created_at":"2026-01-12T16:33:32.944382+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.8.2","title":"‚ö†Ô∏è HIGH: createPluginInstall is async without awaits","description":"File: src/plugin-install.ts:70-115\nIssue: createPluginInstall is declared async but only uses sync fs calls and contains no await. This needlessly returns a Promise, complicates call sites, and can hide errors (callers not awaiting may miss failures). It also creates inconsistency: deprecated createPluginSymlink is sync, while main API is async.\nFix: Either (A) make createPluginInstall synchronous (remove async/Promise) and keep createPluginInstalls sync, OR (B) switch to fs.promises APIs and await them consistently. Prefer simplest: sync functions given current usage.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T16:35:05.489981+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:37:50.938934+01:00","closed_at":"2026-01-12T16:37:50.938934+01:00","close_reason":"Fixed - made functions synchronous","dependencies":[{"issue_id":"plugin-h2w.8.2","depends_on_id":"plugin-h2w.8","type":"parent-child","created_at":"2026-01-12T16:35:05.490952+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.8.3","title":"üí° SUGGESTION: reduce duplicate removal logic via helper","description":"File: src/plugin-install.ts:85-101 and 134-150 and 233-248\nIssue: Directory/file/symlink removal logic is duplicated in createPluginInstall, createPluginSymlink (deprecated), and cleanupStalePluginInstalls.\nWhy it matters: Duplicated logic increases chance of divergence/regressions (e.g., missing force:true or missing recursive:true in one place).\nFix: Extract a small internal helper like removePathIfExists(path) that does lstatSync + rmSync/unlinkSync with ENOENT handling, and reuse.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T16:35:10.392848+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:39:00.723678+01:00","closed_at":"2026-01-12T16:39:00.723678+01:00","close_reason":"Fixed - extracted removePathIfExists helper","dependencies":[{"issue_id":"plugin-h2w.8.3","depends_on_id":"plugin-h2w.8","type":"parent-child","created_at":"2026-01-12T16:35:10.394008+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.9","title":"Update index.ts to pass installMethod and use new imports","description":"Update the main plugin file to use renamed modules and pass installMethod.\n\n## Implementation Details\n\n1. Update imports:\n```typescript\nimport {\n  createInstallsForRepo,\n  cleanupStaleSymlinks,\n  hasLocalConflict,\n  ensureGitignore,\n  ensurePluginsDir,\n  type InstallMethod,\n} from \"./install\"\nimport {\n  createPluginInstalls,\n  getRemotePluginSymlinks,\n  cleanupStalePluginSymlinks,\n  getPluginSymlinkName,\n} from \"./plugin-install\"\nimport { log, logError, logDebug } from \"./logging\"\n```\n\n2. Remove local log/logError functions (now imported)\n\n3. Pass installMethod to install functions:\n```typescript\n// In performSync function\nconst symlinkResults = await createInstallsForRepo(filteredResult, pluginConfig.installMethod)\n\n// For plugins\nconst symlinkResults = await createPluginInstalls(allPlugins, undefined, pluginConfig.installMethod)\n```\n\n4. Log which install method is being used (once, at startup):\n```typescript\nif (pluginConfig.installMethod === \"copy\") {\n  logDebug(\"Using copy mode for skill/plugin installation\")\n} else {\n  logDebug(\"Using symlink mode for skill/plugin installation\")\n}\n```\n\n## File Locations\n- Modify: `src/index.ts`\n\n## Acceptance Criteria\n- [ ] Imports updated to use install.ts and plugin-install.ts\n- [ ] Imports logging from logging.ts\n- [ ] Local log/logError functions removed\n- [ ] installMethod passed to createInstallsForRepo\n- [ ] installMethod passed to createPluginInstalls\n- [ ] Install method logged at debug level\n- [ ] All existing functionality preserved","status":"closed","priority":2,"issue_type":"task","estimated_minutes":25,"created_at":"2026-01-12T15:21:00.093296+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:47:05.834434+01:00","closed_at":"2026-01-12T16:47:05.834434+01:00","close_reason":"Implemented and verified","dependencies":[{"issue_id":"plugin-h2w.9","depends_on_id":"plugin-h2w","type":"parent-child","created_at":"2026-01-12T15:21:00.094115+01:00","created_by":"jgordijn"},{"issue_id":"plugin-h2w.9","depends_on_id":"plugin-h2w.7","type":"blocks","created_at":"2026-01-12T15:21:50.23334+01:00","created_by":"jgordijn"},{"issue_id":"plugin-h2w.9","depends_on_id":"plugin-h2w.8","type":"blocks","created_at":"2026-01-12T15:21:50.458082+01:00","created_by":"jgordijn"},{"issue_id":"plugin-h2w.9","depends_on_id":"plugin-h2w.2","type":"blocks","created_at":"2026-01-12T15:21:50.586236+01:00","created_by":"jgordijn"},{"issue_id":"plugin-h2w.9","depends_on_id":"plugin-h2w.3","type":"blocks","created_at":"2026-01-12T15:21:50.716877+01:00","created_by":"jgordijn"}]}
{"id":"plugin-h2w.9.1","title":"‚ö†Ô∏è HIGH: Ensure copy/symlink mode log appears at desired verbosity","description":"File: src/index.ts:243-248\nIssue: Startup log of install method changed from log() to logDebug(). If users rely on seeing install mode in normal output for troubleshooting, this may reduce observability.\nWhy it matters: Behavior/operability change could hide important mode selection, making support harder.\nFix: Confirm project standard is to log this at debug. If not, keep log() or add a one-time log() plus debug details.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T16:43:56.140117+01:00","created_by":"jgordijn","updated_at":"2026-01-12T16:45:34.876335+01:00","closed_at":"2026-01-12T16:45:34.876335+01:00","close_reason":"Implementation matches bead specification. Parent epic design decision specifies logDebug for install method to avoid nagging users - log still written to file for troubleshooting","dependencies":[{"issue_id":"plugin-h2w.9.1","depends_on_id":"plugin-h2w.9","type":"parent-child","created_at":"2026-01-12T16:43:56.141169+01:00","created_by":"jgordijn"}]}
{"id":"plugin-hen","title":"Write tests for plugin functionality","description":"Create test suite covering:\n\n- Configuration parsing and validation\n- Git sync operations (mock git commands)\n- Symlink creation and cleanup\n- Conflict detection\n- .gitignore management\n- Error handling scenarios","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-28T12:44:27.131279+01:00","updated_at":"2025-12-28T13:06:03.598102+01:00","closed_at":"2025-12-28T13:06:03.598102+01:00","close_reason":"Test suite created with 25 tests covering config parsing and git operations.","dependencies":[{"issue_id":"plugin-hen","depends_on_id":"plugin-de0","type":"blocks","created_at":"2025-12-28T12:44:35.092314+01:00","created_by":"daemon"},{"issue_id":"plugin-hen","depends_on_id":"plugin-dpt","type":"blocks","created_at":"2025-12-28T12:44:43.943334+01:00","created_by":"daemon"}]}
{"id":"plugin-jhr","title":"Write plugin documentation and README","description":"Create comprehensive documentation:\n\n- README.md with:\n  - Installation instructions\n  - Configuration examples\n  - Usage guide\n  - Troubleshooting\n- TypeScript JSDoc comments for public APIs\n- Example configurations for common use cases","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-28T12:44:25.20984+01:00","updated_at":"2025-12-28T13:04:30.365305+01:00","closed_at":"2025-12-28T13:04:30.365305+01:00","close_reason":"README.md created with installation, configuration, and usage documentation.","dependencies":[{"issue_id":"plugin-jhr","depends_on_id":"plugin-de0","type":"blocks","created_at":"2025-12-28T12:44:34.905227+01:00","created_by":"daemon"},{"issue_id":"plugin-jhr","depends_on_id":"plugin-dpt","type":"blocks","created_at":"2025-12-28T12:44:43.767762+01:00","created_by":"daemon"}]}
{"id":"plugin-jys","title":"Improve git error logging","description":"Git errors were not properly logged, making it hard for users to diagnose issues. Now captures and logs the actual stderr from git commands.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T15:03:43.279604+01:00","updated_at":"2025-12-28T15:04:00.807814+01:00","closed_at":"2025-12-28T15:04:00.807814+01:00","close_reason":"Closed"}
{"id":"plugin-n5p","title":"Remote Command Registration","description":"Implement command discovery and registration from remote Git repositories, matching the existing pattern for skills and agents.\n\nCommands are slash commands with templates that users can invoke like /review or /deploy/staging.\n\nChild tasks:\n1. Create command schema and types (src/command.ts)\n2. Implement discoverCommands() function\n3. Add commands field to repository config schema\n4. Inject commands via config hook\n5. Update JSON Schema for editor autocomplete\n6. Add tests for command discovery","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-04T19:43:03.258646+01:00","updated_at":"2026-01-04T19:50:39.986035+01:00","closed_at":"2026-01-04T19:50:39.986035+01:00","close_reason":"Implemented complete command registration feature matching agent pattern"}
{"id":"plugin-n5p.1","title":"Create command schema and types","description":"Create src/command.ts with:\n- CommandConfigSchema (Zod schema matching OpenCode's Config.command)\n- CommandConfig type\n- CommandInfo interface (name, path, config)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T19:43:11.623191+01:00","updated_at":"2026-01-04T19:43:54.665106+01:00","closed_at":"2026-01-04T19:43:54.665106+01:00","close_reason":"Created src/command.ts with CommandConfigSchema and CommandInfo interface","dependencies":[{"issue_id":"plugin-n5p.1","depends_on_id":"plugin-n5p","type":"parent-child","created_at":"2026-01-04T19:43:11.625799+01:00","created_by":"daemon"}]}
{"id":"plugin-n5p.2","title":"Implement discoverCommands function","description":"Add discoverCommands() to src/git.ts:\n- Look in command/ or commands/ directory\n- Parse .md files with YAML frontmatter\n- Apply same discovery limits as agents\n- Validate names against safe character set\n- Return CommandInfo[] array","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T19:43:13.325006+01:00","updated_at":"2026-01-04T19:45:52.634141+01:00","closed_at":"2026-01-04T19:45:52.634141+01:00","close_reason":"Implemented discoverCommands() with same limits and security as discoverAgents()","dependencies":[{"issue_id":"plugin-n5p.2","depends_on_id":"plugin-n5p","type":"parent-child","created_at":"2026-01-04T19:43:13.328897+01:00","created_by":"daemon"}]}
{"id":"plugin-n5p.3","title":"Add commands filter to repository config","description":"Update src/config.ts:\n- Add 'commands' field to RepositoryConfigSchema\n- Same pattern as skills/agents: '*' or array of names\n- Update JSON Schema in remote-skills.schema.json","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T19:43:14.705677+01:00","updated_at":"2026-01-04T19:47:04.969886+01:00","closed_at":"2026-01-04T19:47:04.969886+01:00","close_reason":"Added commands filter to RepositoryConfigSchema and JSON Schema","dependencies":[{"issue_id":"plugin-n5p.3","depends_on_id":"plugin-n5p","type":"parent-child","created_at":"2026-01-04T19:43:14.708732+01:00","created_by":"daemon"}]}
{"id":"plugin-n5p.4","title":"Inject commands via config hook","description":"Update src/index.ts:\n- Track discovered commands per repo\n- Filter commands based on repository config\n- Inject into OpenCode config.command via config hook\n- Respect user config precedence (hasOwnProperty check)\n- Log injected commands count","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T19:43:16.478096+01:00","updated_at":"2026-01-04T19:48:47.597504+01:00","closed_at":"2026-01-04T19:48:47.597504+01:00","close_reason":"Added command injection via config hook with same precedence rules as agents","dependencies":[{"issue_id":"plugin-n5p.4","depends_on_id":"plugin-n5p","type":"parent-child","created_at":"2026-01-04T19:43:16.480625+01:00","created_by":"daemon"}]}
{"id":"plugin-n5p.5","title":"Add tests for command discovery","description":"Create tests in src/git.test.ts and src/command.test.ts:\n- Test command discovery from command/ directory\n- Test frontmatter parsing\n- Test name validation\n- Test discovery limits\n- Test config hook injection\n- Test user config precedence","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T19:43:18.011563+01:00","updated_at":"2026-01-04T19:50:34.250979+01:00","closed_at":"2026-01-04T19:50:34.250979+01:00","close_reason":"Added 18 tests for command discovery covering schema validation, discovery, nesting, and security","dependencies":[{"issue_id":"plugin-n5p.5","depends_on_id":"plugin-n5p","type":"parent-child","created_at":"2026-01-04T19:43:18.015101+01:00","created_by":"daemon"}]}
{"id":"plugin-n9k","title":"Add remote agent registration via config hook","description":"## Overview\n\nExtend the `opencode-remote-skills` plugin to discover and register **agents** from remote Git repositories via the OpenCode `config` hook, without requiring changes to the user's OpenCode config directory.\n\n## Background\n\nOpenCode has two distinct concepts:\n- **Skills**: Reference documents loaded via the `skill` tool (require symlinks)\n- **Agents**: Autonomous subagents delegated to via the `task` tool (can be injected via config hook)\n\nThe existing plugin handles skills via symlinks. This epic adds agent support via the `config` hook, which allows plugins to mutate the config object before agents are loaded.\n\n## Repository Structure Convention\n\nRemote repositories follow OpenCode's native directory structure:\n\n```\nmy-repo/\n‚îú‚îÄ‚îÄ skill/                      # Existing - skills (SKILL.md files)\n‚îÇ   ‚îî‚îÄ‚îÄ code-review/\n‚îÇ       ‚îî‚îÄ‚îÄ SKILL.md\n‚îî‚îÄ‚îÄ agent/                      # NEW - agents (*.md files)\n    ‚îú‚îÄ‚îÄ code-reviewer.md        # Agent: \"code-reviewer\"\n    ‚îú‚îÄ‚îÄ kotlin-pro.md           # Agent: \"kotlin-pro\"\n    ‚îî‚îÄ‚îÄ specialized/            # Nested agents\n        ‚îî‚îÄ‚îÄ db-expert.md        # Agent: \"specialized/db-expert\"\n```\n\n## Agent Markdown Format\n\nAgents use the same format as OpenCode native agents:\n\n```markdown\n---\ndescription: Expert code review specialist\nmode: subagent\nmodel: anthropic/claude-sonnet-4-20250514\ncolor: \"#FF5733\"\ntemperature: 0.3\npermission:\n  edit: deny\n  bash: ask\nsteps: 50\n---\n\nYou are an expert code reviewer...\n```\n\nThis translates to `AgentConfig` JSON:\n\n```json\n{\n  \"code-reviewer\": {\n    \"description\": \"Expert code review specialist\",\n    \"mode\": \"subagent\",\n    \"model\": \"anthropic/claude-sonnet-4-20250514\",\n    \"color\": \"#FF5733\",\n    \"temperature\": 0.3,\n    \"permission\": {\n      \"edit\": \"deny\",\n      \"bash\": \"ask\"\n    },\n    \"steps\": 50,\n    \"prompt\": \"You are an expert code reviewer...\"\n  }\n}\n```\n\n## Configuration\n\nExtend `remote-skills.json` to support optional agent filtering:\n\n```jsonc\n{\n  \"repositories\": [\n    {\n      \"url\": \"git@github.com:company/shared-config.git\",\n      \"ref\": \"main\",\n      \"skills\": [\"code-review\", \"git-commit\"],\n      \"agents\": [\"code-reviewer\", \"kotlin-pro\"]  // NEW - optional filter\n    },\n    {\n      \"url\": \"git@github.com:team/team-tools.git\",\n      \"skills\": \"*\",\n      \"agents\": \"*\"  // Import all agents\n    }\n  ],\n  \"sync\": \"blocking\"\n}\n```\n\n## Priority Order (Conflict Resolution)\n\n1. **User's local config** (`~/.config/opencode/opencode.json` or `.opencode/agent/*.md`) - highest priority\n2. **First remote repository** that defines an agent - wins\n3. **Subsequent repositories** with same agent name - logged and skipped\n\n## Error Handling\n\nMatch skills behavior - graceful degradation with logging:\n1. **Parsing fails** (invalid YAML): Log warning, skip the agent\n2. **Validation fails** (invalid schema): Log warning with details, skip the agent\n3. **File without frontmatter**: Silently skip (not an agent definition)\n\n## Implementation Details\n\n### New Dependency: `gray-matter`\n\nAdd the `gray-matter` npm package for parsing markdown frontmatter. This is the same library OpenCode uses internally.\n\n### New File: `src/agent.ts`\n\nDefine Zod schemas matching OpenCode's `AgentConfig`:\n\n```typescript\nconst PermissionAction = z.enum([\"ask\", \"allow\", \"deny\"])\nconst PermissionRule = z.union([PermissionAction, z.record(z.string(), PermissionAction)])\nconst Permission = z.record(z.string(), PermissionRule).or(PermissionAction)\n\nexport const AgentConfigSchema = z.object({\n  model: z.string().optional(),\n  temperature: z.number().optional(),\n  top_p: z.number().optional(),\n  prompt: z.string().optional(),\n  tools: z.record(z.string(), z.boolean()).optional(),\n  disable: z.boolean().optional(),\n  description: z.string().optional(),\n  mode: z.enum([\"subagent\", \"primary\", \"all\"]).optional(),\n  options: z.record(z.string(), z.any()).optional(),\n  color: z.string().regex(/^#[0-9a-fA-F]{6}$/).optional(),\n  steps: z.number().int().positive().optional(),\n  maxSteps: z.number().int().positive().optional(),\n  permission: Permission.optional(),\n}).passthrough()\n\nexport interface AgentInfo {\n  name: string\n  path: string\n  config: AgentConfig\n}\n```\n\n### Modified File: `src/config.ts`\n\nAdd `agents` filter to `RepositoryConfigSchema`:\n\n```typescript\nexport const RepositoryConfigSchema = z.object({\n  url: z.string().min(1),\n  ref: z.string().optional(),\n  skills: z.union([z.literal(\"*\"), z.array(z.string())]).optional(),\n  agents: z.union([z.literal(\"*\"), z.array(z.string())]).optional(),  // NEW\n}).strict()\n```\n\n### Modified File: `src/git.ts`\n\nAdd agent discovery:\n\n```typescript\nexport interface SyncResult {\n  // existing fields...\n  skills: SkillInfo[]\n  agents: AgentInfo[]   // NEW\n}\n\nexport async function discoverAgents(repoPath: string): Promise\u003cAgentInfo[]\u003e\n```\n\nAgent discovery logic:\n1. Look for `agent/` or `agents/` directory\n2. Recursively find all `*.md` files\n3. Parse with `gray-matter` (YAML frontmatter + markdown body)\n4. Skip files without frontmatter\n5. Validate against `AgentConfigSchema`\n6. Calculate name from path: `agent/category/name.md` ‚Üí `category/name`\n7. Return array of `AgentInfo`\n\n### Modified File: `src/index.ts`\n\nAdd `config` hook:\n\n```typescript\nreturn {\n  config: async (config) =\u003e {\n    config.agent = config.agent || {}\n    \n    for (const [name, { config: agentConfig, source }] of remoteAgents) {\n      if (config.agent[name]) {\n        log(`‚ö† Agent '${name}' exists in user config, skipping remote from ${source}`)\n        continue\n      }\n      config.agent[name] = agentConfig\n    }\n  },\n  // existing event handler...\n}\n```\n\n## Files Changed Summary\n\n| File              | Change Type | Description                                                    |\n| ----------------- | ----------- | -------------------------------------------------------------- |\n| `package.json`      | Modify      | Add `gray-matter` dependency, update description                 |\n| `src/agent.ts`      | New         | AgentConfig schema and AgentInfo type                          |\n| `src/config.ts`     | Modify      | Add `agents` filter to RepositoryConfig                          |\n| `src/git.ts`        | Modify      | Add `discoverAgents()`, update SyncResult, update sync functions |\n| `src/index.ts`      | Modify      | Add `config` hook to inject agents                               |\n| `src/agent.test.ts` | New         | Tests for agent parsing and validation                         |\n| `src/git.test.ts`   | Modify      | Add agent discovery tests                                      |\n| `README.md`         | Modify      | Document agent support                                         |\n\n## Acceptance Criteria\n\n- [ ] Agents discovered from `agent/` or `agents/` directories in remote repos\n- [ ] Nested agent naming works: `agent/category/name.md` ‚Üí `category/name`\n- [ ] YAML frontmatter parsed correctly with `gray-matter`\n- [ ] Agent config validated against Zod schema\n- [ ] Invalid agents logged and skipped (graceful degradation)\n- [ ] User config takes priority over remote agents\n- [ ] First plugin registration wins for duplicate agent names\n- [ ] Duplicate/conflict cases logged appropriately\n- [ ] Optional `agents` filter in repository config works\n- [ ] All tests pass\n- [ ] README updated with agent documentation","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-04T09:53:58.273116+01:00","updated_at":"2026-01-04T10:35:31.858174+01:00","closed_at":"2026-01-04T10:35:31.858174+01:00","close_reason":"Remote agent registration fully implemented with discovery, config hook injection, priority handling, and comprehensive tests"}
{"id":"plugin-n9k.1","title":"Add gray-matter dependency","description":"Add the `gray-matter` npm package for parsing markdown frontmatter.\n\n## Changes\n\n**File: `package.json`**\n\n```json\n{\n  \"dependencies\": {\n    \"gray-matter\": \"^4.0.3\",\n    \"zod\": \"^3.24.1\"\n  }\n}\n```\n\n## Notes\n\n- This is the same library OpenCode uses internally for parsing agent/skill markdown\n- Version 4.0.3 is stable and mature (last updated 2 years ago)\n- Also update the package description to reflect agents support\n\n## Acceptance Criteria\n\n- [ ] `gray-matter` added to dependencies\n- [ ] `bun install` succeeds\n- [ ] Package description updated to mention agents","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T09:54:10.52942+01:00","updated_at":"2026-01-04T10:08:24.4527+01:00","closed_at":"2026-01-04T10:08:24.4527+01:00","close_reason":"Added gray-matter dependency and updated package description","dependencies":[{"issue_id":"plugin-n9k.1","depends_on_id":"plugin-n9k","type":"parent-child","created_at":"2026-01-04T09:54:10.535862+01:00","created_by":"daemon"}]}
{"id":"plugin-n9k.1.1","title":"Remove untracked testconfig/ from working tree","description":"File: testconfig/skill/log (untracked).\\n\\nIssue: An untracked directory appears in git status. This risks accidentally committing local test artifacts and creates noise in reviews/CI.\\n\\nWhy it matters: Keeping the working tree clean prevents accidental commits and makes automated workflows/reviews reliable.\\n\\nHow to fix: Either delete the testconfig/ directory if it is generated, or add the appropriate ignore rule to .gitignore. If it is meant to be committed, clarify its purpose and add it intentionally with minimal required contents.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T10:06:30.984261+01:00","updated_at":"2026-01-04T10:07:19.872032+01:00","closed_at":"2026-01-04T10:07:19.872032+01:00","close_reason":"Added testconfig/ to .gitignore","dependencies":[{"issue_id":"plugin-n9k.1.1","depends_on_id":"plugin-n9k.1","type":"parent-child","created_at":"2026-01-04T10:06:30.985286+01:00","created_by":"jgordijn"}]}
{"id":"plugin-n9k.10","title":"Update package metadata and README","description":"Update description and README for agents support.\n\n## Changes\n\n### File: `package.json`\n\nUpdate description:\n\n```json\n{\n  \"description\": \"OpenCode plugin to sync skills and agents from Git repositories\"\n}\n```\n\n### File: `README.md`\n\nAdd agents documentation:\n\n1. **Overview section** - mention agents alongside skills\n\n2. **New \"Agents\" section**:\n   - Explain agent discovery from `agent/` directory\n   - Show agent markdown format with frontmatter\n   - Explain naming convention for nested agents\n   - Show config example with `agents` filter\n\n3. **Configuration section** - add `agents` field to examples\n\n4. **Priority section** - document conflict resolution:\n   - User config \u003e first remote repo \u003e subsequent repos\n\n5. **Example section** - complete repository structure:\n   ```\n   my-repo/\n   ‚îú‚îÄ‚îÄ skill/\n   ‚îÇ   ‚îî‚îÄ‚îÄ code-review/\n   ‚îÇ       ‚îî‚îÄ‚îÄ SKILL.md\n   ‚îî‚îÄ‚îÄ agent/\n       ‚îú‚îÄ‚îÄ code-reviewer.md\n       ‚îî‚îÄ‚îÄ specialized/\n           ‚îî‚îÄ‚îÄ db-expert.md\n   ```\n\n## README Structure\n\n```markdown\n# OpenCode Remote Skills\n\nSync skills and agents from Git repositories...\n\n## Features\n- Import skills from remote repositories\n- Import agents from remote repositories  # NEW\n- Selective import by name\n- Conflict detection with local config\n\n## Installation\n...\n\n## Configuration\n...\n\n## Skills\n...\n\n## Agents  # NEW SECTION\n...\n\n## Priority \u0026 Conflicts\n...\n```\n\n## Acceptance Criteria\n\n- [ ] Package description updated\n- [ ] README documents agent support\n- [ ] Agent markdown format documented\n- [ ] Configuration examples include agents\n- [ ] Conflict resolution documented","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-04T09:56:35.55624+01:00","updated_at":"2026-01-04T10:35:21.877888+01:00","closed_at":"2026-01-04T10:35:21.877888+01:00","close_reason":"Updated README with agent documentation, configuration examples, and priority handling","dependencies":[{"issue_id":"plugin-n9k.10","depends_on_id":"plugin-n9k","type":"parent-child","created_at":"2026-01-04T09:56:35.558555+01:00","created_by":"daemon"},{"issue_id":"plugin-n9k.10","depends_on_id":"plugin-n9k.6","type":"blocks","created_at":"2026-01-04T09:56:35.559975+01:00","created_by":"daemon"}]}
{"id":"plugin-n9k.2","title":"Create agent types and schema","description":"Define `AgentConfig` Zod schema and `AgentInfo` interface in new `src/agent.ts`.\n\n## New File: `src/agent.ts`\n\n```typescript\nimport { z } from \"zod\"\n\n// Match OpenCode's permission schema\nconst PermissionAction = z.enum([\"ask\", \"allow\", \"deny\"])\nconst PermissionRule = z.union([\n  PermissionAction,\n  z.record(z.string(), PermissionAction)\n])\nconst Permission = z.record(z.string(), PermissionRule)\n  .or(PermissionAction)\n\n// Match OpenCode's AgentConfig schema\nexport const AgentConfigSchema = z.object({\n  model: z.string().optional(),\n  temperature: z.number().optional(),\n  top_p: z.number().optional(),\n  prompt: z.string().optional(),\n  tools: z.record(z.string(), z.boolean()).optional(),\n  disable: z.boolean().optional(),\n  description: z.string().optional(),\n  mode: z.enum([\"subagent\", \"primary\", \"all\"]).optional(),\n  options: z.record(z.string(), z.any()).optional(),\n  color: z.string().regex(/^#[0-9a-fA-F]{6}$/).optional(),\n  steps: z.number().int().positive().optional(),\n  maxSteps: z.number().int().positive().optional(),\n  permission: Permission.optional(),\n}).passthrough()  // Allow unknown keys (they go to options)\n\nexport type AgentConfig = z.infer\u003ctypeof AgentConfigSchema\u003e\n\nexport interface AgentInfo {\n  name: string\n  path: string\n  config: AgentConfig\n}\n```\n\n## Notes\n\n- Schema matches OpenCode's `Config.Agent` schema from `packages/opencode/src/config/config.ts`\n- `.passthrough()` allows unknown keys which OpenCode puts into `options`\n- Permission schema supports both simple actions and per-pattern rules\n\n## Acceptance Criteria\n\n- [ ] `AgentConfigSchema` validates correctly against OpenCode agent format\n- [ ] `AgentInfo` interface defined with name, path, config\n- [ ] TypeScript compiles without errors","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T09:54:25.49932+01:00","updated_at":"2026-01-04T10:16:25.314245+01:00","closed_at":"2026-01-04T10:16:25.314245+01:00","close_reason":"Created AgentConfigSchema and AgentInfo types","dependencies":[{"issue_id":"plugin-n9k.2","depends_on_id":"plugin-n9k","type":"parent-child","created_at":"2026-01-04T09:54:25.503346+01:00","created_by":"daemon"},{"issue_id":"plugin-n9k.2","depends_on_id":"plugin-n9k.1","type":"blocks","created_at":"2026-01-04T09:54:25.504783+01:00","created_by":"daemon"}]}
{"id":"plugin-n9k.3","title":"Extend repository config schema for agents filter","description":"Add optional `agents` filter to `RepositoryConfig` in `src/config.ts`.\n\n## Changes\n\n**File: `src/config.ts`**\n\nAdd `agents` field to `RepositoryConfigSchema`:\n\n```typescript\nexport const RepositoryConfigSchema = z.object({\n  /** Git URL (SSH or HTTPS) */\n  url: z.string().min(1, \"Repository URL is required\"),\n  \n  /** Git ref to checkout (branch, tag, or commit SHA). Defaults to default branch. */\n  ref: z.string().optional(),\n  \n  /** \n   * List of skill names to import. \n   * If omitted or set to \"*\", imports all skills from the repository.\n   */\n  skills: z.union([\n    z.literal(\"*\"),\n    z.array(z.string())\n  ]).optional(),\n  \n  /** \n   * List of agent names to import. \n   * If omitted or set to \"*\", imports all agents from the repository.\n   */\n  agents: z.union([\n    z.literal(\"*\"),\n    z.array(z.string())\n  ]).optional(),\n}).strict()\n```\n\n## Example Configuration\n\n```jsonc\n{\n  \"repositories\": [\n    {\n      \"url\": \"git@github.com:company/shared-config.git\",\n      \"ref\": \"main\",\n      \"skills\": [\"code-review\"],\n      \"agents\": [\"code-reviewer\", \"kotlin-pro\"]\n    },\n    {\n      \"url\": \"git@github.com:team/tools.git\",\n      \"agents\": \"*\"  // Import all agents\n    }\n  ]\n}\n```\n\n## Acceptance Criteria\n\n- [ ] `agents` field added to schema (optional, array of strings or \"*\")\n- [ ] Existing config tests still pass\n- [ ] Schema validates example configurations correctly","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T09:54:38.28562+01:00","updated_at":"2026-01-04T10:18:15.160935+01:00","closed_at":"2026-01-04T10:18:15.160935+01:00","close_reason":"Added agents filter to repository config schema","dependencies":[{"issue_id":"plugin-n9k.3","depends_on_id":"plugin-n9k","type":"parent-child","created_at":"2026-01-04T09:54:38.288392+01:00","created_by":"daemon"},{"issue_id":"plugin-n9k.3","depends_on_id":"plugin-n9k.1","type":"blocks","created_at":"2026-01-04T09:54:38.28981+01:00","created_by":"daemon"}]}
{"id":"plugin-n9k.4","title":"Implement agent discovery function","description":"Add `discoverAgents()` function in `src/git.ts` with nested directory support.\n\n## Changes\n\n**File: `src/git.ts`**\n\nAdd imports and new function:\n\n```typescript\nimport matter from \"gray-matter\"\nimport { AgentConfigSchema, type AgentInfo } from \"./agent\"\n\n/**\n * Discover agents in a repository.\n * Agents are markdown files in agent/ or agents/ directories.\n * Supports nested directories: agent/category/name.md ‚Üí \"category/name\"\n */\nexport async function discoverAgents(repoPath: string): Promise\u003cAgentInfo[]\u003e {\n  const agents: AgentInfo[] = []\n  \n  // Support both \"agent/\" and \"agents/\"\n  let agentDir = path.join(repoPath, \"agent\")\n  if (!fs.existsSync(agentDir)) {\n    agentDir = path.join(repoPath, \"agents\")\n  }\n  \n  if (!fs.existsSync(agentDir)) {\n    return agents\n  }\n  \n  // Recursively find *.md files\n  const findAgents = (dir: string) =\u003e {\n    const entries = fs.readdirSync(dir, { withFileTypes: true })\n    \n    for (const entry of entries) {\n      if (entry.name.startsWith(\".\")) continue\n      \n      const fullPath = path.join(dir, entry.name)\n      \n      if (entry.isDirectory()) {\n        findAgents(fullPath)\n      } else if (entry.name.endsWith(\".md\")) {\n        try {\n          const content = fs.readFileSync(fullPath, \"utf-8\")\n          const parsed = parseAgentMarkdown(fullPath, content, agentDir)\n          if (parsed) {\n            agents.push(parsed)\n          }\n        } catch (err) {\n          console.error(`[remote-skills] Failed to parse agent ${fullPath}:`, err)\n        }\n      }\n    }\n  }\n  \n  findAgents(agentDir)\n  return agents\n}\n\n/**\n * Parse an agent markdown file into AgentInfo.\n * Follows OpenCode's naming convention for nested agents.\n */\nfunction parseAgentMarkdown(\n  filePath: string, \n  content: string, \n  agentDir: string\n): AgentInfo | null {\n  let md: matter.GrayMatterFile\u003cstring\u003e\n  \n  try {\n    md = matter(content)\n  } catch (err) {\n    console.error(`[remote-skills] Failed to parse frontmatter in ${filePath}:`, err)\n    return null\n  }\n  \n  // Skip files without frontmatter (not an agent definition)\n  if (!md.data || Object.keys(md.data).length === 0) {\n    return null\n  }\n  \n  // Calculate agent name from path (matching OpenCode's logic)\n  const relativePath = path.relative(agentDir, filePath)\n  const agentName = relativePath.replace(/\\.md$/, \"\")\n  \n  // Build config: frontmatter + body as prompt\n  const rawConfig = {\n    ...md.data,\n    prompt: md.content.trim() || undefined,\n  }\n  \n  // Validate against schema\n  const result = AgentConfigSchema.safeParse(rawConfig)\n  if (!result.success) {\n    console.error(`[remote-skills] Invalid agent config in ${filePath}:`, \n      result.error.format())\n    return null\n  }\n  \n  return {\n    name: agentName,\n    path: filePath,\n    config: result.data,\n  }\n}\n```\n\n## Naming Convention\n\nFollowing OpenCode's logic:\n- `agent/code-reviewer.md` ‚Üí agent name: `code-reviewer`\n- `agent/specialized/db-expert.md` ‚Üí agent name: `specialized/db-expert`\n\n## Error Handling\n\nMatches skills behavior:\n- Parsing fails (invalid YAML): Log warning, skip\n- Validation fails: Log warning with details, skip\n- No frontmatter: Silently skip (not an agent)\n\n## Acceptance Criteria\n\n- [ ] Discovers agents from `agent/` directory\n- [ ] Falls back to `agents/` directory\n- [ ] Supports nested directories with correct naming\n- [ ] Parses YAML frontmatter with `gray-matter`\n- [ ] Validates against `AgentConfigSchema`\n- [ ] Skips files without frontmatter silently\n- [ ] Logs and skips invalid agents gracefully","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T09:55:01.138405+01:00","updated_at":"2026-01-04T10:22:04.196495+01:00","closed_at":"2026-01-04T10:22:04.196495+01:00","close_reason":"Implemented agent discovery function with cross-platform path normalization","dependencies":[{"issue_id":"plugin-n9k.4","depends_on_id":"plugin-n9k","type":"parent-child","created_at":"2026-01-04T09:55:01.14214+01:00","created_by":"daemon"},{"issue_id":"plugin-n9k.4","depends_on_id":"plugin-n9k.2","type":"blocks","created_at":"2026-01-04T09:55:01.143649+01:00","created_by":"daemon"}]}
{"id":"plugin-n9k.5","title":"Update sync functions to include agents","description":"Extend `SyncResult` type and modify sync functions to discover and filter agents.\n\n## Changes\n\n**File: `src/git.ts`**\n\n### Update SyncResult interface:\n\n```typescript\nexport interface SyncResult {\n  repoId: string\n  repoPath: string\n  shortName: string\n  ref: string\n  skills: SkillInfo[]\n  agents: AgentInfo[]   // NEW\n  updated: boolean\n  error?: string\n}\n```\n\n### Update syncGitRepository():\n\n```typescript\nasync function syncGitRepository(config: RepositoryConfig): Promise\u003cSyncResult\u003e {\n  // ... existing clone/fetch logic ...\n  \n  // Discover skills (existing)\n  let skills = await discoverSkills(repoPath)\n  if (config.skills \u0026\u0026 config.skills !== \"*\" \u0026\u0026 Array.isArray(config.skills)) {\n    const requestedSkills = new Set(config.skills)\n    skills = skills.filter(s =\u003e requestedSkills.has(s.name))\n  }\n  \n  // Discover agents (NEW)\n  let agents = await discoverAgents(repoPath)\n  if (config.agents \u0026\u0026 config.agents !== \"*\" \u0026\u0026 Array.isArray(config.agents)) {\n    const requestedAgents = new Set(config.agents)\n    agents = agents.filter(a =\u003e requestedAgents.has(a.name))\n  }\n  \n  return {\n    repoId,\n    repoPath,\n    shortName,\n    ref: currentRef,\n    skills,\n    agents,   // NEW\n    updated,\n    error,\n  }\n}\n```\n\n### Update syncLocalDirectory():\n\nApply same pattern for local file:// URLs.\n\n## Filtering Behavior\n\n- If `agents` is omitted: import all agents\n- If `agents` is `\"*\"`: import all agents\n- If `agents` is array: import only listed agents\n\n## Acceptance Criteria\n\n- [ ] `SyncResult.agents` field added\n- [ ] `syncGitRepository` calls `discoverAgents`\n- [ ] `syncLocalDirectory` calls `discoverAgents`\n- [ ] Agent filtering by repository config works\n- [ ] Existing skill sync behavior unchanged","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T09:55:15.960924+01:00","updated_at":"2026-01-04T10:22:58.992337+01:00","closed_at":"2026-01-04T10:22:58.992337+01:00","close_reason":"Already implemented in sm-n9k.4 - SyncResult includes agents, both sync functions call discoverAgents with filtering","dependencies":[{"issue_id":"plugin-n9k.5","depends_on_id":"plugin-n9k","type":"parent-child","created_at":"2026-01-04T09:55:15.964664+01:00","created_by":"daemon"},{"issue_id":"plugin-n9k.5","depends_on_id":"plugin-n9k.3","type":"blocks","created_at":"2026-01-04T09:55:15.966095+01:00","created_by":"daemon"},{"issue_id":"plugin-n9k.5","depends_on_id":"plugin-n9k.4","type":"blocks","created_at":"2026-01-04T09:55:15.968127+01:00","created_by":"daemon"}]}
{"id":"plugin-n9k.6","title":"Implement config hook for agent injection","description":"Add `config` hook to inject remote agents with priority handling.\n\n## Changes\n\n**File: `src/index.ts`**\n\n### Collect agents during sync:\n\n```typescript\n// After performSync() completes, collect all agents\nconst remoteAgents = new Map\u003cstring, { config: AgentConfig; source: string }\u003e()\n\nfor (const result of syncResults) {\n  if (result.error) continue\n  \n  for (const agent of result.agents) {\n    if (remoteAgents.has(agent.name)) {\n      // Already registered from another repo - log and skip\n      const existing = remoteAgents.get(agent.name)!\n      log(`‚ö† Agent '${agent.name}' already loaded from ${existing.source}, skipping from ${result.shortName}`)\n      continue\n    }\n    \n    remoteAgents.set(agent.name, {\n      config: agent.config,\n      source: result.shortName,\n    })\n  }\n}\n\nlog(`Discovered ${remoteAgents.size} remote agents`)\n```\n\n### Add config hook to return value:\n\n```typescript\nreturn {\n  /**\n   * Config hook: inject remote agents into config.agent\n   * Priority: user config \u003e first plugin to register\n   */\n  config: async (config) =\u003e {\n    config.agent = config.agent || {}\n    \n    for (const [name, { config: agentConfig, source }] of remoteAgents) {\n      // Skip if user already has this agent defined\n      if (config.agent[name]) {\n        log(`‚ö† Agent '${name}' exists in user config, skipping remote from ${source}`)\n        continue\n      }\n      \n      config.agent[name] = agentConfig\n    }\n  },\n  \n  // existing event handler...\n  event: async ({ event }) =\u003e {\n    // Could listen for session.idle to show background sync results\n  },\n}\n```\n\n## Priority Order\n\n1. **User's local config** - highest priority (already in config.agent)\n2. **First remote repository** - registered in remoteAgents map\n3. **Subsequent repositories** - logged and skipped\n\n## Logging\n\n- Log count of discovered agents after sync\n- Log when skipping duplicate from another repo\n- Log when skipping because user config has priority\n\n## Acceptance Criteria\n\n- [ ] `config` hook added to plugin return value\n- [ ] Agents injected into `config.agent` object\n- [ ] User config takes priority (not overwritten)\n- [ ] First repo wins for duplicate agent names\n- [ ] Appropriate logging for conflicts/skips","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T09:55:33.526218+01:00","updated_at":"2026-01-04T10:28:48.515785+01:00","closed_at":"2026-01-04T10:28:48.515785+01:00","close_reason":"Implemented config hook for agent injection with priority handling","dependencies":[{"issue_id":"plugin-n9k.6","depends_on_id":"plugin-n9k","type":"parent-child","created_at":"2026-01-04T09:55:33.529304+01:00","created_by":"daemon"},{"issue_id":"plugin-n9k.6","depends_on_id":"plugin-n9k.5","type":"blocks","created_at":"2026-01-04T09:55:33.530723+01:00","created_by":"daemon"}]}
{"id":"plugin-n9k.7","title":"Add agent parsing tests","description":"Test frontmatter parsing, validation, and nested naming.\n\n## New File: `src/agent.test.ts`\n\n### Test Cases\n\n1. **Parse simple agent markdown**\n   - Valid frontmatter with description, mode, model\n   - Body becomes prompt field\n\n2. **Parse agent with all fields**\n   - temperature, top_p, color, steps, permission\n   - Verify all fields preserved correctly\n\n3. **Parse nested agent path**\n   - `agent/category/name.md` ‚Üí name: `category/name`\n   - `agent/deep/nested/agent.md` ‚Üí name: `deep/nested/agent`\n\n4. **Handle invalid frontmatter**\n   - Malformed YAML returns null\n   - Error is logged\n\n5. **Handle invalid schema**\n   - Wrong types (e.g., temperature: \"hot\")\n   - Invalid color format\n   - Returns null with logged error\n\n6. **Skip file without frontmatter**\n   - Plain markdown file returns null\n   - No error logged (silent skip)\n\n7. **Validate permission parsing**\n   - Simple: `permission: allow`\n   - Object: `permission: { edit: deny, bash: ask }`\n   - Mixed patterns work correctly\n\n8. **Handle empty prompt**\n   - No body ‚Üí prompt is undefined\n   - Whitespace-only body ‚Üí prompt is undefined\n\n## Example Test\n\n```typescript\nimport { describe, test, expect } from \"bun:test\"\nimport { AgentConfigSchema } from \"./agent\"\n\ndescribe(\"AgentConfigSchema\", () =\u003e {\n  test(\"validates simple agent config\", () =\u003e {\n    const config = {\n      description: \"Test agent\",\n      mode: \"subagent\",\n      prompt: \"You are a test agent\",\n    }\n    const result = AgentConfigSchema.safeParse(config)\n    expect(result.success).toBe(true)\n  })\n  \n  test(\"rejects invalid color format\", () =\u003e {\n    const config = {\n      color: \"red\",  // Should be #RRGGBB\n    }\n    const result = AgentConfigSchema.safeParse(config)\n    expect(result.success).toBe(false)\n  })\n})\n```\n\n## Acceptance Criteria\n\n- [ ] All parsing test cases pass\n- [ ] All validation test cases pass\n- [ ] Edge cases covered (empty, whitespace, malformed)\n- [ ] Error logging verified","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-04T09:55:50.912389+01:00","updated_at":"2026-01-04T10:30:17.434403+01:00","closed_at":"2026-01-04T10:30:17.434403+01:00","close_reason":"Added comprehensive agent schema tests covering validation, modes, colors, permissions, and prompts","dependencies":[{"issue_id":"plugin-n9k.7","depends_on_id":"plugin-n9k","type":"parent-child","created_at":"2026-01-04T09:55:50.915237+01:00","created_by":"daemon"},{"issue_id":"plugin-n9k.7","depends_on_id":"plugin-n9k.4","type":"blocks","created_at":"2026-01-04T09:55:50.916438+01:00","created_by":"daemon"}]}
{"id":"plugin-n9k.8","title":"Add agent discovery tests","description":"Test directory discovery, filtering, and integration with skills.\n\n## File: `src/git.test.ts` (extend existing)\n\n### Test Cases\n\n1. **Discover agents from agent/ directory**\n   - Create temp directory with agent/*.md files\n   - Verify all agents found with correct names\n\n2. **Discover agents from agents/ directory**\n   - Fallback when agent/ doesn't exist\n   - Same discovery behavior\n\n3. **Handle missing agent directory**\n   - No agent/ or agents/ directory\n   - Returns empty array, no error\n\n4. **Discover nested agents**\n   - `agent/category/name.md`\n   - Correct name: `category/name`\n\n5. **Filter agents by config**\n   - Repository config with `agents: [\"specific-agent\"]`\n   - Only matching agents returned\n\n6. **Import all agents with wildcard**\n   - `agents: \"*\"` imports everything\n   - Same as omitting agents field\n\n7. **Integration: skills and agents together**\n   - Repo with both skill/ and agent/ directories\n   - Both discovered correctly in SyncResult\n\n8. **Skip hidden files**\n   - `.hidden-agent.md` not discovered\n   - `.hidden/` directory not traversed\n\n## Example Test\n\n```typescript\nimport { describe, test, expect, beforeEach, afterEach } from \"bun:test\"\nimport { discoverAgents } from \"./git\"\nimport * as fs from \"fs\"\nimport * as path from \"path\"\nimport * as os from \"os\"\n\ndescribe(\"discoverAgents\", () =\u003e {\n  let tempDir: string\n  \n  beforeEach(() =\u003e {\n    tempDir = fs.mkdtempSync(path.join(os.tmpdir(), \"test-agents-\"))\n  })\n  \n  afterEach(() =\u003e {\n    fs.rmSync(tempDir, { recursive: true })\n  })\n  \n  test(\"discovers agents from agent/ directory\", async () =\u003e {\n    const agentDir = path.join(tempDir, \"agent\")\n    fs.mkdirSync(agentDir)\n    fs.writeFileSync(\n      path.join(agentDir, \"test-agent.md\"),\n      \"---\\ndescription: Test\\nmode: subagent\\n---\\nPrompt here\"\n    )\n    \n    const agents = await discoverAgents(tempDir)\n    expect(agents).toHaveLength(1)\n    expect(agents[0].name).toBe(\"test-agent\")\n  })\n})\n```\n\n## Acceptance Criteria\n\n- [ ] All discovery test cases pass\n- [ ] Filtering test cases pass\n- [ ] Integration with skills verified\n- [ ] Edge cases covered","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-04T09:56:06.664727+01:00","updated_at":"2026-01-04T10:31:32.824487+01:00","closed_at":"2026-01-04T10:31:32.824487+01:00","close_reason":"Added comprehensive agent discovery tests covering directories, nesting, filtering, validation, and edge cases","dependencies":[{"issue_id":"plugin-n9k.8","depends_on_id":"plugin-n9k","type":"parent-child","created_at":"2026-01-04T09:56:06.668147+01:00","created_by":"daemon"},{"issue_id":"plugin-n9k.8","depends_on_id":"plugin-n9k.5","type":"blocks","created_at":"2026-01-04T09:56:06.669578+01:00","created_by":"daemon"}]}
{"id":"plugin-n9k.9","title":"Add config hook tests","description":"Test injection, priority handling, and conflict logging.\n\n## New File: `src/index.test.ts` or extend existing\n\n### Test Cases\n\n1. **Inject agents into empty config**\n   - `config.agent` is undefined/empty\n   - All remote agents injected\n\n2. **User config takes priority**\n   - `config.agent.my-agent` already exists\n   - Remote `my-agent` skipped\n   - Warning logged\n\n3. **First repository wins**\n   - Two repos define same agent\n   - First one's config used\n   - Second one logged and skipped\n\n4. **Multiple agents from multiple repos**\n   - Repo A: agent-a, agent-b\n   - Repo B: agent-c, agent-b (duplicate)\n   - Result: agent-a, agent-b (from A), agent-c\n\n5. **Empty agents collection**\n   - No agents discovered\n   - Config hook still runs, no changes\n\n6. **Logging verification**\n   - Capture console output\n   - Verify conflict messages logged correctly\n\n## Mocking Strategy\n\n```typescript\n// Mock the sync results\nconst mockSyncResults: SyncResult[] = [\n  {\n    repoId: \"test-1\",\n    shortName: \"repo-a\",\n    ref: \"main\",\n    skills: [],\n    agents: [\n      { name: \"agent-a\", path: \"/path/a\", config: { mode: \"subagent\" } },\n    ],\n    updated: false,\n  },\n]\n\n// Mock config object\nconst mockConfig = {\n  agent: {\n    \"existing-agent\": { mode: \"subagent\" },\n  },\n}\n```\n\n## Acceptance Criteria\n\n- [ ] Injection into empty config works\n- [ ] User config priority verified\n- [ ] First-repo-wins behavior verified\n- [ ] Conflict logging verified\n- [ ] Edge cases covered","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-04T09:56:21.13737+01:00","updated_at":"2026-01-04T10:33:16.294525+01:00","closed_at":"2026-01-04T10:33:16.294525+01:00","close_reason":"Added config hook tests covering agent collection, injection, and priority handling","dependencies":[{"issue_id":"plugin-n9k.9","depends_on_id":"plugin-n9k","type":"parent-child","created_at":"2026-01-04T09:56:21.140097+01:00","created_by":"daemon"},{"issue_id":"plugin-n9k.9","depends_on_id":"plugin-n9k.6","type":"blocks","created_at":"2026-01-04T09:56:21.141375+01:00","created_by":"daemon"}]}
{"id":"plugin-nlp","title":"Add strict schema validation to remote-skills.json config","description":"The Zod schema currently allows unknown keys. Add .strict() to reject unrecognized configuration keys, matching OpenCode's behavior.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T14:45:51.923398+01:00","updated_at":"2025-12-28T14:47:12.300871+01:00","closed_at":"2025-12-28T14:47:12.300871+01:00","close_reason":"Closed"}
{"id":"plugin-o01","title":"Implement Git repository sync","description":"Implement the Git sync functionality:\n\n- Clone repos to ~/.cache/opencode/remote-skills/repos/\u003crepo-id\u003e/\n- Generate repo-id from URL (e.g., github.com-company-shared-skills)\n- Support initial clone via 'git clone'\n- Support updates via 'git fetch \u0026\u0026 git checkout \u003cref\u003e'\n- Handle ref as branch, tag, or commit SHA\n- Use Bun shell ($) for git commands\n- Handle authentication via system git (SSH keys, credential helpers)\n- Return list of available skills from each repo","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T12:44:01.344327+01:00","updated_at":"2025-12-28T12:59:02.738101+01:00","closed_at":"2025-12-28T12:59:02.738101+01:00","close_reason":"Git sync implemented with clone, fetch/checkout, and skill discovery functionality.","dependencies":[{"issue_id":"plugin-o01","depends_on_id":"plugin-de0","type":"blocks","created_at":"2025-12-28T12:44:33.842597+01:00","created_by":"daemon"},{"issue_id":"plugin-o01","depends_on_id":"plugin-ejp","type":"blocks","created_at":"2025-12-28T12:44:42.529568+01:00","created_by":"daemon"}]}
{"id":"plugin-r3q","title":"Use full git clone instead of shallow clone","description":"The plugin was using --depth 1 shallow clones which caused issues with checking out non-default branches. Changed to full clone as per original requirements.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T15:03:41.004927+01:00","updated_at":"2025-12-28T15:04:00.805119+01:00","closed_at":"2025-12-28T15:04:00.805119+01:00","close_reason":"Closed"}
{"id":"plugin-sc0","title":"Generate JSON Schema file for editor autocomplete","description":"Create a JSON Schema file (remote-skills.schema.json) that editors can use for validation and autocomplete, similar to OpenCode's https://opencode.ai/config.json. Users can reference it via $schema in their config.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T14:45:57.534958+01:00","updated_at":"2026-01-04T14:50:28.243289+01:00","closed_at":"2026-01-04T14:50:28.243289+01:00","close_reason":"Created remote-skills.schema.json with full config validation for editor autocomplete"}
{"id":"plugin-sw0","title":"Remote Plugin Registration","description":"Implement plugin discovery and registration from remote Git repositories.\n\nPlugins are small hook files (.ts/.js) that live in plugin/ directories. They will be symlinked to ~/.config/opencode/plugin/ using flat naming convention:\n_remote_\u003crepo\u003e_\u003cplugin-name\u003e.\u003cext\u003e\n\nKey features:\n- Discover .ts/.js files in plugin/ or plugins/ directories\n- Filter plugins via config (like skills/agents/commands)\n- Create symlinks with flat naming (OpenCode doesn't support subdirectories)\n- Detect changes and notify user to restart\n- Clean up stale symlinks when plugins are removed\n\nNote: Self-contained requirement (no local imports) - document for now, detect later.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-04T22:24:14.376832+01:00","updated_at":"2026-01-05T13:56:12.720894+01:00","closed_at":"2026-01-05T13:56:12.720894+01:00","close_reason":"Remote Plugin Registration feature complete"}
{"id":"plugin-sw0.1","title":"Create plugin discovery types","description":"Create src/plugin-info.ts with:\n- PluginInfo interface (name, path, repoShortName)\n- No schema needed (plugins are just files, not parsed)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T00:02:55.386921+01:00","updated_at":"2026-01-05T13:17:15.86008+01:00","closed_at":"2026-01-05T13:17:15.86008+01:00","close_reason":"Created PluginInfo interface in src/plugin-info.ts","dependencies":[{"issue_id":"plugin-sw0.1","depends_on_id":"plugin-sw0","type":"parent-child","created_at":"2026-01-05T00:02:55.40749+01:00","created_by":"daemon"}]}
{"id":"plugin-sw0.2","title":"Implement discoverPlugins function","description":"Add discoverPlugins() to src/git.ts:\n- Scan plugin/ or plugins/ directory for .ts and .js files\n- Apply same discovery limits as agents (max 100, 256KB, depth 10)\n- Validate filenames (safe characters only)\n- Return PluginInfo[] array\n- Update SyncResult to include plugins field","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T00:02:56.057495+01:00","updated_at":"2026-01-05T13:20:19.916155+01:00","closed_at":"2026-01-05T13:20:19.916155+01:00","close_reason":"Implemented discoverPlugins() with same limits and security as agents/commands","dependencies":[{"issue_id":"plugin-sw0.2","depends_on_id":"plugin-sw0","type":"parent-child","created_at":"2026-01-05T00:02:56.062217+01:00","created_by":"daemon"}]}
{"id":"plugin-sw0.3","title":"Add plugins filter to config schema","description":"Update src/config.ts:\n- Add 'plugins' field to RepositoryConfigSchema\n- Same pattern as skills/agents/commands: '*' or array of names\n- Update remote-skills.schema.json with plugins field","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T00:02:57.187953+01:00","updated_at":"2026-01-05T13:21:27.238043+01:00","closed_at":"2026-01-05T13:21:27.238043+01:00","close_reason":"Added plugins filter to RepositoryConfigSchema and JSON Schema","dependencies":[{"issue_id":"plugin-sw0.3","depends_on_id":"plugin-sw0","type":"parent-child","created_at":"2026-01-05T00:02:57.192832+01:00","created_by":"daemon"}]}
{"id":"plugin-sw0.4","title":"Implement plugin symlink management","description":"Create src/plugin-symlinks.ts:\n- Target: ~/.config/opencode/plugin/\n- Naming: _remote_\u003crepo\u003e_\u003cplugin-name\u003e.\u003cext\u003e\n- Nested paths use dashes: plugin/utils/logger.ts ‚Üí _remote_repo_utils-logger.ts\n- createPluginSymlinks() - create symlinks for discovered plugins\n- getRemotePluginSymlinks() - list existing _remote_* symlinks\n- cleanupStalePluginSymlinks() - remove symlinks not in current set","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T00:03:02.016636+01:00","updated_at":"2026-01-05T13:22:17.904933+01:00","closed_at":"2026-01-05T13:22:17.904933+01:00","close_reason":"Created plugin-symlinks.ts with symlink creation, cleanup, and naming functions","dependencies":[{"issue_id":"plugin-sw0.4","depends_on_id":"plugin-sw0","type":"parent-child","created_at":"2026-01-05T00:03:02.025165+01:00","created_by":"daemon"}]}
{"id":"plugin-sw0.5","title":"Add restart notification on plugin changes","description":"Update src/index.ts:\n- Compare existing _remote_* symlinks with new set after sync\n- If different, log: '[remote-skills] Plugin changes detected. Restart OpenCode to apply.'\n- No persistent state file needed - just compare filesystem state","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T00:03:02.227698+01:00","updated_at":"2026-01-05T13:25:22.02814+01:00","closed_at":"2026-01-05T13:25:22.02814+01:00","close_reason":"Closed","dependencies":[{"issue_id":"plugin-sw0.5","depends_on_id":"plugin-sw0","type":"parent-child","created_at":"2026-01-05T00:03:02.229366+01:00","created_by":"daemon"}]}
{"id":"plugin-sw0.6","title":"Add tests for plugin discovery and symlinks","description":"Create tests:\n- src/git.test.ts: discoverPlugins() tests (discovery, filtering, limits, extensions)\n- src/plugin-symlinks.test.ts: symlink creation, naming convention, cleanup\n- Integration tests for change detection","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T00:03:04.031611+01:00","updated_at":"2026-01-05T13:47:23.797917+01:00","closed_at":"2026-01-05T13:47:23.797917+01:00","close_reason":"Added 28 tests for discoverPlugins and plugin-symlinks","dependencies":[{"issue_id":"plugin-sw0.6","depends_on_id":"plugin-sw0","type":"parent-child","created_at":"2026-01-05T00:03:04.037957+01:00","created_by":"daemon"}]}
{"id":"plugin-sw0.6.1","title":"plugin-symlinks.test.ts should not interact with real ~/.config/opencode/plugin","description":"File: opencode-remote-skills/src/plugin-symlinks.test.ts (multiple tests around getRemotePluginSymlinks/cleanupStalePluginSymlinks).\\n\\nIssue: current tests call getRemotePluginSymlinks() and cleanupStalePluginSymlinks() without isolating PLUGIN_DIR. This makes tests depend on developer machine state and can delete real _remote_* symlinks (see the test \"result has correct shape\" comment), creating a serious side effect and flaky CI behavior.\\n\\nWhy it matters: tests must be hermetic; deleting user symlinks is data-loss for local dev and can break other tests / environments.\\n\\nHow to fix: refactor plugin-symlinks.ts to accept pluginDir as a parameter (or export a factory/constant that tests can override), then update tests to use a temp directory and assert actual filesystem operations (symlink created, listed, cleanup removes stale) within the temp dir.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-05T13:42:44.751082+01:00","updated_at":"2026-01-05T13:45:50.476892+01:00","closed_at":"2026-01-05T13:45:50.476892+01:00","close_reason":"Refactored plugin-symlinks.ts to accept pluginDir parameter, tests now use temp directories"}
{"id":"plugin-sw0.6.2","title":"Remove stray CLAUDE.md from working tree","description":"File: CLAUDE.md (untracked, 0-byte).\\n\\nIssue: An unexpected CLAUDE.md file is present and untracked. Even though empty now, it risks being accidentally committed and violates smallest-change principle.\\n\\nWhy it matters: repo hygiene; potential for unwanted docs/policies, and can confuse reviewers/CI if later populated.\\n\\nHow to fix: delete CLAUDE.md (or add to .gitignore if it is a tool artifact that will reappear).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T13:42:44.751237+01:00","updated_at":"2026-01-05T13:46:04.431924+01:00","closed_at":"2026-01-05T13:46:04.431924+01:00","close_reason":"CLAUDE.md is not part of this PR, skipping","dependencies":[{"issue_id":"plugin-sw0.6.2","depends_on_id":"plugin-sw0.6","type":"parent-child","created_at":"2026-01-05T13:42:44.752747+01:00","created_by":"jgordijn"}]}
{"id":"plugin-sw0.6.3","title":"Fix bd parent-child link for plugin-sw0.6.1 (database locked)","description":"While creating subtask plugin-sw0.6.1, bd reported: 'failed to add parent-child dependency plugin-sw0.6.1 -\u003e plugin-sw0.6: sqlite3: database is locked'.\\n\\nWhy it matters: subtask might not show under the parent bead, breaking the workflow.\\n\\nHow to fix: rerun bd add-dependency (or re-create/link) once the DB lock is cleared; ensure plugin-sw0.6.1 is linked as child of plugin-sw0.6.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T13:42:50.576912+01:00","updated_at":"2026-01-05T13:46:04.639825+01:00","closed_at":"2026-01-05T13:46:04.639825+01:00","close_reason":"DB lock was temporary, resolved","dependencies":[{"issue_id":"plugin-sw0.6.3","depends_on_id":"plugin-sw0.6","type":"parent-child","created_at":"2026-01-05T13:42:50.578595+01:00","created_by":"jgordijn"}]}
{"id":"plugin-sw0.6.4","title":"opencode-remote-skills/CLAUDE.md is untracked and should be removed or gitignored","description":"File: CLAUDE.md (untracked).\\n\\nIssue: There is an untracked CLAUDE.md in the repo root. Even if empty, it is easy to accidentally commit and adds repo noise.\\n\\nWhy it matters: repo hygiene and review safety; reduces risk of committing tool artifacts.\\n\\nHow to fix: delete CLAUDE.md if not needed, or add a specific ignore rule if it is a recurring tool artifact.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T13:46:26.813446+01:00","updated_at":"2026-01-05T13:46:58.654199+01:00","closed_at":"2026-01-05T13:46:58.654199+01:00","close_reason":"CLAUDE.md is not part of this PR scope, existed before this work","dependencies":[{"issue_id":"plugin-sw0.6.4","depends_on_id":"plugin-sw0.6","type":"parent-child","created_at":"2026-01-05T13:46:26.814373+01:00","created_by":"jgordijn"}]}
{"id":"plugin-sw0.7","title":"Update documentation for plugins","description":"Update README.md with:\n- Plugin discovery section (directory structure, file format)\n- Self-contained requirement (no local imports)\n- Configuration example with plugins filter\n- Uninstall guide (empty config first, then remove plugin)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T00:03:05.518372+01:00","updated_at":"2026-01-05T13:55:15.348215+01:00","closed_at":"2026-01-05T13:55:15.348215+01:00","close_reason":"Added plugin documentation to README","dependencies":[{"issue_id":"plugin-sw0.7","depends_on_id":"plugin-sw0","type":"parent-child","created_at":"2026-01-05T00:03:05.525021+01:00","created_by":"daemon"}]}
{"id":"plugin-sw0.7.1","title":"Clarify plugin discovery edge cases: plugin vs plugins dirs and supported file layout","description":"File: opencode-remote-skills/README.md (Plugins section ~lines 152-165; repo structure example ~lines 265-284).\\n\\nIssue: Docs state discovery from  or  directories, but the repository-structure example only shows . Also symlink naming examples include  -\u003e  (flattening path with '-') but does not explicitly define how nested paths are normalized, or how name collisions are handled (e.g.,  vs ).\\n\\nWhy it matters: Users will structure repos incorrectly or hit surprising collisions when paths flatten.\\n\\nHow to fix: Add explicit rules: which root dirs are scanned (both), recursive scan policy, how path separators are mapped (e.g.,  -\u003e ), and how collisions are resolved (warn + skip, last-wins, etc.) aligned with implementation.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T13:51:02.802802+01:00","updated_at":"2026-01-05T13:54:46.232774+01:00","closed_at":"2026-01-05T13:54:46.232774+01:00","close_reason":"Added discovery rules, collision handling, and naming conversion rules"}
{"id":"plugin-sw0.7.2","title":"Remove or gate CLI log output examples to avoid emoji/unicode issues","description":"File: opencode-remote-skills/README.md (Example Output ~lines 172-183; restart warning ~lines 167-170).\\n\\nIssue: Example output uses unicode symbols (‚úì, ‚ö†). Some environments/log collectors may not render these cleanly, and it may not match the actual logger output format (if it uses ASCII).\\n\\nWhy it matters: Minor, but can confuse users if their output differs; also copy/paste into terminals with different encoding can look odd.\\n\\nHow to fix: Either confirm implementation prints these exact symbols, or switch examples to plain ASCII ([OK], [WARN]) or mention they are illustrative.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T13:51:02.802892+01:00","updated_at":"2026-01-05T13:54:51.963493+01:00","closed_at":"2026-01-05T13:54:51.963493+01:00","close_reason":"Removed unicode from plugin restart warning for consistency","dependencies":[{"issue_id":"plugin-sw0.7.2","depends_on_id":"plugin-sw0.7","type":"parent-child","created_at":"2026-01-05T13:51:02.804317+01:00","created_by":"jgordijn"}]}
{"id":"plugin-sw0.7.3","title":"Fix uninstall docs: wrong removal path and wrong orphaned symlink locations","description":"File: opencode-remote-skills/README.md (Uninstalling section ~lines 408-427).\\n\\nIssue: Uninstall guide contains shell code snippets/paths that can mislead users: it only shows removing , but earlier the docs also show a project-local install under . Also the warning about orphaned symlinks should match actual behavior documented elsewhere: skills are under , and plugins are symlinked as flat files into  (likely with a  prefix).\\n\\nWhy it matters: Users may delete the wrong directory and still leave stale symlinks behind, causing confusing behavior or load errors on startup.\\n\\nHow to fix: Document uninstall both for global and project-local installs, and precisely call out cleanup locations (skills: ; plugins:  or whatever prefix the implementation uses). Ensure wording matches implementation.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-05T13:53:18.139575+01:00","updated_at":"2026-01-05T13:54:46.015807+01:00","closed_at":"2026-01-05T13:54:46.015807+01:00","close_reason":"Added both global and project-local uninstall paths, clarified orphan symlink locations","dependencies":[{"issue_id":"plugin-sw0.7.3","depends_on_id":"plugin-sw0.7","type":"parent-child","created_at":"2026-01-05T13:53:18.140788+01:00","created_by":"jgordijn"}]}
{"id":"plugin-sw0.8","title":"Detect non-self-contained plugin files","description":"Future enhancement:\n- Parse plugin files to detect local imports (./foo, ../bar)\n- Warn user if plugin has local dependencies\n- Skip or document the limitation\n\nThis is a future bead - for now just document the self-contained requirement.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T00:03:07.976497+01:00","updated_at":"2026-01-05T13:56:06.386876+01:00","closed_at":"2026-01-05T13:56:06.386876+01:00","close_reason":"Documented in README; detection deferred to future work","dependencies":[{"issue_id":"plugin-sw0.8","depends_on_id":"plugin-sw0","type":"parent-child","created_at":"2026-01-05T00:03:07.983406+01:00","created_by":"daemon"}]}
{"id":"plugin-t9v","title":"Prevent duplicate plugin initialization","description":"Plugin runs twice on startup, likely due to OpenCode loading it for multiple contexts. Need to add a guard to prevent duplicate syncs within the same process.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T15:08:00.236542+01:00","updated_at":"2025-12-28T15:08:28.438829+01:00","closed_at":"2025-12-28T15:08:28.438829+01:00","close_reason":"Closed"}
